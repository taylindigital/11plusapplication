<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bright Stars Education - 11+ Learning Platform</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⭐</text></svg>">
    
    <!-- MSAL Browser Library for Azure B2C Authentication -->
    <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
    
    <!-- Stripe.js Library -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Google Fonts for playful typography -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Playful color palette inspired by PDF */
            --primary-purple: #8B5FBF;
            --bright-orange: #FF9B47;
            --sunny-yellow: #FFD93D;
            --grass-green: #6BCF7F;
            --sky-blue: #4ECDC4;
            --coral-pink: #FF6B9D;
            --soft-lavender: #C8A8E9;
            
            /* Functional colors */
            --text-dark: #2D3748;
            --text-medium: #4A5568;
            --text-light: #718096;
            --bg-light: #F7FAFC;
            --white: #FFFFFF;
            --shadow: rgba(0,0,0,0.1);
            --shadow-hover: rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--soft-lavender) 0%, var(--sky-blue) 50%, var(--sunny-yellow) 100%);
            min-height: 100vh;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        /* Prevent printing */
        @media print {
            body { display: none !important; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: var(--white);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            z-index: 2;
        }

        .logo-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: contain;
        }

        .logo-banner {
            height: 80px;
            object-fit: contain;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 2;
        }

        .subscription-badge {
            background: linear-gradient(135deg, var(--grass-green), #52C41A);
            color: var(--white);
            padding: 8px 18px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(107, 207, 127, 0.3);
            position: relative;
        }

        .subscription-badge.inactive {
            background: linear-gradient(135deg, var(--coral-pink), #FF4D4F);
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.3);
        }

        .subscription-badge::before {
            content: '✨';
            margin-right: 6px;
        }

        /* Cloud-style buttons */
        .btn {
            background: linear-gradient(135deg, var(--primary-purple), #9c6fd4);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(139, 95, 191, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 95, 191, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--text-medium), #2D3748);
            box-shadow: 0 4px 15px rgba(74, 85, 104, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 25px rgba(74, 85, 104, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--coral-pink), #FF4D4F);
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--grass-green), #52C41A);
            box-shadow: 0 4px 15px rgba(107, 207, 127, 0.3);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Club Selection Screen */
        .club-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
            gap: 40px;
        }

        .club-selection-title {
            font-family: 'Fredoka One', cursive;
            font-size: 42px;
            color: var(--primary-purple);
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(139, 95, 191, 0.2);
        }

        .club-selection-subtitle {
            font-size: 20px;
            color: var(--text-medium);
            margin-bottom: 40px;
            font-weight: 400;
        }

        .club-boxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 40px;
            width: 100%;
            max-width: 900px;
        }

        .club-box {
            background: var(--white);
            padding: 40px 30px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 15px 40px var(--shadow);
            position: relative;
            overflow: hidden;
            min-height: 280px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .club-box:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 60px var(--shadow-hover);
        }

        .club-box.year4 {
            background: linear-gradient(135deg, rgba(255, 155, 71, 0.1), rgba(255, 217, 61, 0.1));
            border: 3px solid rgba(255, 155, 71, 0.3);
        }

        .club-box.year4::before {
            content: '';
            position: absolute;
            top: -20px;
            right: -20px;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, var(--bright-orange), transparent);
            opacity: 0.2;
            border-radius: 50%;
        }

        .club-box.year5 {
            background: linear-gradient(135deg, rgba(107, 207, 127, 0.1), rgba(78, 205, 196, 0.1));
            border: 3px solid rgba(107, 207, 127, 0.3);
        }

        .club-box.year5::before {
            content: '';
            position: absolute;
            top: -20px;
            right: -20px;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, var(--grass-green), transparent);
            opacity: 0.2;
            border-radius: 50%;
        }

        .club-icon {
            font-size: 64px;
            margin-bottom: 20px;
            filter: drop-shadow(2px 2px 6px rgba(0,0,0,0.1));
        }

        .club-box.year4 .club-icon {
            color: var(--bright-orange);
        }

        .club-box.year5 .club-icon {
            color: var(--grass-green);
        }

        .club-title {
            font-family: 'Fredoka One', cursive;
            font-size: 28px;
            color: var(--text-dark);
            margin-bottom: 12px;
        }

        .club-subtitle {
            font-size: 18px;
            color: var(--text-medium);
            font-weight: 600;
            margin-bottom: 16px;
        }

        .club-description {
            font-size: 16px;
            color: var(--text-light);
            line-height: 1.5;
        }

        /* Dashboard with new navigation */
        .dashboard {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .sidebar {
            background: var(--white);
            border-radius: 25px;
            padding: 30px 0;
            height: fit-content;
            box-shadow: 0 15px 40px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(135deg, var(--soft-lavender), var(--sky-blue));
            opacity: 0.1;
            pointer-events: none;
        }

        .sidebar-header {
            padding: 0 30px 20px;
            border-bottom: 2px solid var(--bg-light);
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        .sidebar-title {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            color: var(--primary-purple);
            margin-bottom: 8px;
        }

        .sidebar-subtitle {
            font-size: 14px;
            color: var(--text-light);
            font-weight: 500;
        }

        .back-to-clubs {
    background: linear-gradient(135deg, var(--text-light), var(--text-medium));
    color: var(--white);
    border: none;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 14px;
    cursor: pointer;
    margin-bottom: 20px;
    margin-left: 30px;
    transition: all 0.3s ease;
    position: relative;
    z-index: 1000;
    pointer-events: auto;
}

        .back-to-clubs:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 85, 104, 0.3);
        }

        .nav-section {
            margin-bottom: 25px;
        }

        .nav-section-title {
            font-family: 'Fredoka One', cursive;
            font-size: 16px;
            color: var(--text-medium);
            padding: 0 30px 10px;
            margin-bottom: 10px;
        }

        .nav-item {
            padding: 16px 30px;
            margin: 0;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-medium);
            font-weight: 500;
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-item:hover {
            background: linear-gradient(90deg, rgba(139, 95, 191, 0.1), transparent);
            color: var(--primary-purple);
            padding-left: 40px;
        }

        .nav-item.active {
            background: linear-gradient(90deg, var(--primary-purple), rgba(139, 95, 191, 0.8));
            color: var(--white);
            box-shadow: 0 4px 15px rgba(139, 95, 191, 0.3);
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 15px solid transparent;
            border-bottom: 15px solid transparent;
            border-left: 15px solid var(--primary-purple);
        }

        .nav-item-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .content-area {
            background: var(--white);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 15px 40px var(--shadow);
            position: relative;
            min-height: 500px;
            overflow: hidden;
        }

        .content-area::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, var(--sunny-yellow) 0%, transparent 70%);
            opacity: 0.05;
            border-radius: 50%;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 2;
        }

        .content-title {
            font-family: 'Fredoka One', cursive;
            font-size: 36px;
            color: var(--primary-purple);
            margin-bottom: 8px;
        }

        .content-subtitle {
            font-size: 16px;
            color: var(--text-light);
            font-weight: 400;
        }

        /* Cloud-style content cards */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            position: relative;
            z-index: 2;
        }

        .content-card {
            background: var(--white);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 25px var(--shadow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            min-height: 280px;
        }
        
        .content-card.enhanced {
            min-height: 320px;
            padding: 30px;
        }
        
        .content-card.preview {
            cursor: default;
            min-height: auto;
            padding: 20px;
        }

        .content-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 35px var(--shadow-hover);
            border-color: var(--primary-purple);
        }

        .content-card.maths {
            border-left: 5px solid var(--bright-orange);
        }

        .content-card.english {
            border-left: 5px solid var(--grass-green);
        }

        .content-card.resources {
            border-left: 5px solid var(--sky-blue);
        }

        .content-card.planning {
            border-left: 5px solid var(--coral-pink);
        }

        .card-icon {
            font-size: 48px;
            margin-bottom: 16px;
            display: block;
        }

        .content-card.maths .card-icon {
            color: var(--bright-orange);
        }

        .content-card.english .card-icon {
            color: var(--grass-green);
        }

        .content-card.resources .card-icon {
            color: var(--sky-blue);
        }

        .content-card.planning .card-icon {
            color: var(--coral-pink);
        }

        .card-title {
            font-family: 'Fredoka One', cursive;
            font-size: 22px;
            color: var(--text-dark);
            margin-bottom: 12px;
        }

        .card-description {
            font-size: 14px;
            color: var(--text-light);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .card-meta {
            font-size: 12px;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .card-meta span {
            background: rgba(0, 0, 0, 0.05);
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 500;
        }

        .card-actions {
            margin-top: auto;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            display: flex;
            gap: 10px;
        }
        
        /* Enhanced Content Preview Styles */
        .content-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .content-preview-card {
            background: var(--white);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 15px var(--shadow);
            border-left: 4px solid var(--primary-purple);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .content-preview-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--shadow-hover);
        }
        
        .preview-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .preview-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--background-light);
            border-radius: 12px;
        }
        
        .preview-title {
            font-family: 'Fredoka One', cursive;
            font-size: 16px;
            color: var(--text-dark);
            margin: 0;
        }
        
        .preview-subtitle {
            font-size: 12px;
            color: var(--text-light);
            margin: 0;
        }
        
        .preview-content {
            margin-bottom: 15px;
        }
        
        .preview-description {
            font-size: 13px;
            color: var(--text-light);
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .preview-metadata {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .metadata-tag {
            background: var(--background-light);
            color: var(--text-light);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .preview-actions {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }
        
        .btn-xs {
            padding: 6px 12px;
            font-size: 11px;
            border-radius: 8px;
        }
        
        /* Enhanced Upload Areas */
        .enhanced-upload-section {
            margin-top: 30px;
            padding: 25px;
            background: var(--background-light);
            border-radius: 16px;
            border: 2px dashed var(--border-light);
        }
        
        .upload-section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .upload-section-icon {
            font-size: 32px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 4px 15px var(--shadow);
        }
        
        .upload-section-info h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 20px;
            color: var(--text-dark);
            margin: 0 0 5px 0;
        }
        
        .upload-section-info p {
            font-size: 14px;
            color: var(--text-light);
            margin: 0;
        }
        
        .upload-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: var(--white);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px var(--shadow);
        }
        
        .stat-number {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            color: var(--primary-purple);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 11px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 10px;
            min-width: auto;
        }

        /* Coming Soon overlay */
        .coming-soon {
            text-align: center;
            padding: 80px 20px;
            position: relative;
        }

        .coming-soon-icon {
            font-size: 64px;
            color: var(--primary-purple);
            margin-bottom: 20px;
        }

        .coming-soon h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 32px;
            color: var(--primary-purple);
            margin-bottom: 15px;
        }

        .coming-soon p {
            font-size: 18px;
            color: var(--text-light);
            max-width: 500px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Admin bulk upload section */
        .bulk-upload-section {
            background: linear-gradient(135deg, rgba(255, 155, 71, 0.1), rgba(255, 217, 61, 0.1));
            border: 2px dashed var(--bright-orange);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .bulk-upload-section h4 {
            font-family: 'Fredoka One', cursive;
            color: var(--bright-orange);
            font-size: 24px;
            margin-bottom: 15px;
        }

        .bulk-upload-section p {
            color: var(--text-medium);
            margin-bottom: 20px;
        }

        /* Auth styles */
        .auth-container {
            background: var(--white);
            border-radius: 25px;
            padding: 50px;
            max-width: 450px;
            margin: 100px auto;
            box-shadow: 0 20px 60px var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .auth-container::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, var(--sunny-yellow) 0%, transparent 70%);
            opacity: 0.1;
            border-radius: 50%;
        }

        .auth-container h2 {
            font-family: 'Fredoka One', cursive;
            color: var(--primary-purple);
            margin-bottom: 30px;
            font-size: 32px;
        }

        .auth-logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: contain;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(139, 95, 191, 0.2);
            animation: bounce 2s infinite;
        }

        .auth-status {
            background: var(--bg-light);
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 14px;
        }

        .auth-status.error {
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(255, 77, 79, 0.1));
            border-color: var(--coral-pink);
            color: #742a2a;
        }

        .auth-status.success {
            background: linear-gradient(135deg, rgba(107, 207, 127, 0.1), rgba(82, 196, 26, 0.1));
            border-color: var(--grass-green);
            color: #22543d;
        }

        .auth-status.info {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(64, 169, 255, 0.1));
            border-color: var(--sky-blue);
            color: #003a8c;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
            }
            
            .club-boxes {
                grid-template-columns: 1fr;
            }
            
            .club-selection-title {
                font-size: 32px;
            }
            
            .content-title {
                font-size: 28px;
            }
        }

        /* Loading animations */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .bounce {
            animation: bounce 2s infinite;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Hide default elements */
        .hidden {
            display: none;
        }

        /* Loading and Content States */
        .loading-spinner {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: var(--text-light);
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        .no-content {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
            background: var(--white);
            border-radius: 12px;
            border: 2px dashed var(--border-light);
        }
        
        .error-message {
            text-align: center;
            padding: 20px;
            color: #e74c3c;
            background: #fff5f5;
            border: 1px solid #fecaca;
            border-radius: 12px;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ============================================ */
        /* MICRO-INTERACTIONS & ANIMATIONS */
        /* ============================================ */

        /* Enhanced Loading Animations */
        .loading-spinner-enhanced {
            display: inline-block;
            width: 32px;
            height: 32px;
            border: 3px solid var(--border-light);
            border-top: 3px solid var(--primary-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-dots {
            display: inline-flex;
            gap: 4px;
            align-items: center;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary-purple);
            animation: loadingDots 1.5s ease-in-out infinite;
        }

        .loading-dot:nth-child(1) { animation-delay: 0s; }
        .loading-dot:nth-child(2) { animation-delay: 0.2s; }
        .loading-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes loadingDots {
            0%, 80%, 100% { 
                transform: scale(0.8);
                opacity: 0.6;
            }
            40% { 
                transform: scale(1.2);
                opacity: 1;
            }
        }

        /* Button Micro-Interactions */
        .btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0px) scale(0.98);
            transition: all 0.1s ease;
        }

        .btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Success/Error Feedback Animations */
        .feedback-animation {
            position: relative;
            overflow: hidden;
        }

        .feedback-animation::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .feedback-animation.success::after {
            background: linear-gradient(45deg, transparent, rgba(16, 185, 129, 0.1), transparent);
            opacity: 1;
            animation: successPulse 0.6s ease;
        }

        .feedback-animation.error::after {
            background: linear-gradient(45deg, transparent, rgba(239, 68, 68, 0.1), transparent);
            opacity: 1;
            animation: errorShake 0.6s ease;
        }

        @keyframes successPulse {
            0% { transform: scale(0.95); opacity: 0; }
            50% { transform: scale(1.02); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
            20%, 40%, 60%, 80% { transform: translateX(4px); }
        }

        /* Card Hover Interactions */
        .content-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .content-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px var(--shadow-hover);
        }

        .content-card:hover .card-icon {
            transform: scale(1.1) rotate(5deg);
            transition: transform 0.3s ease;
        }

        .content-card:hover .card-title {
            color: var(--primary-purple);
            transition: color 0.3s ease;
        }

        /* Content Preview Card Animations */
        .content-preview-card {
            animation: slideInUp 0.4s ease forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        .content-preview-card:nth-child(1) { animation-delay: 0.1s; }
        .content-preview-card:nth-child(2) { animation-delay: 0.2s; }
        .content-preview-card:nth-child(3) { animation-delay: 0.3s; }
        .content-preview-card:nth-child(4) { animation-delay: 0.4s; }
        .content-preview-card:nth-child(5) { animation-delay: 0.5s; }
        .content-preview-card:nth-child(6) { animation-delay: 0.6s; }

        @keyframes slideInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Modal Entrance/Exit Animations */
        .modal {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal:not(.hidden) {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal:not(.hidden) .modal-content {
            transform: scale(1) translateY(0);
        }

        /* File Upload Animations */
        .file-upload-area {
            transition: all 0.3s ease;
            position: relative;
        }

        .file-upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-purple);
            opacity: 0;
            border-radius: 12px;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .file-upload-area.drag-over {
            border-color: var(--primary-purple);
            background: rgba(124, 58, 237, 0.05);
            transform: scale(1.02);
        }

        .file-upload-area.drag-over::before {
            opacity: 0.1;
            animation: uploadPulse 1s ease infinite;
        }

        @keyframes uploadPulse {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.2; }
        }

        /* Progress Indicators */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-light);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-purple), var(--sky-blue));
            border-radius: 4px;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShimmer 2s infinite;
        }

        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Navigation Link Animations */
        .nav-link {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.4s ease;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .nav-link.active {
            animation: activeNavPulse 2s ease infinite;
        }

        @keyframes activeNavPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(124, 58, 237, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(124, 58, 237, 0); }
        }

        /* Statistics Animation */
        .stat-number {
            transition: all 0.3s ease;
        }

        .stat-item:hover .stat-number {
            transform: scale(1.2);
            color: var(--primary-purple);
        }

        /* Form Input Animations */
        .form-group input,
        .form-group select {
            transition: all 0.3s ease;
            position: relative;
        }

        .form-group input:focus,
        .form-group select:focus {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.15);
            border-color: var(--primary-purple);
        }

        /* Toast Notification Enhancements */
        .toast {
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(90deg, var(--border-light) 25%, var(--background-light) 50%, var(--border-light) 75%);
            background-size: 200% 100%;
            animation: skeletonLoading 1.5s infinite;
        }

        @keyframes skeletonLoading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-text {
            height: 14px;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .skeleton-title {
            height: 20px;
            border-radius: 6px;
            margin-bottom: 12px;
        }

        .skeleton-card {
            height: 200px;
            border-radius: 16px;
        }

        /* Student Portal & GDPR Compliance Styles */
        .privacy-badge {
            background: var(--grass-green);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .gdpr-consent-banner {
            background: #f8f9ff;
            border: 2px solid var(--primary-purple);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .consent-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .consent-icon {
            font-size: 32px;
            flex-shrink: 0;
        }

        .consent-text h4 {
            font-family: 'Fredoka One', cursive;
            font-size: 18px;
            color: var(--text-dark);
            margin: 0 0 8px 0;
        }

        .consent-text p {
            font-size: 14px;
            color: var(--text-light);
            margin: 0;
            line-height: 1.5;
        }

        .consent-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .progress-overview {
            margin-bottom: 30px;
        }

        .homework-submission-area {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            border: 2px dashed var(--border-light);
            text-align: center;
        }

        .parent-access-card {
            background: var(--white);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 15px var(--shadow);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .access-info h4,
        .privacy-info h4 {
            font-family: 'Fredoka One', cursive;
            font-size: 16px;
            color: var(--text-dark);
            margin: 0 0 10px 0;
        }

        .access-info p,
        .privacy-info p {
            font-size: 14px;
            color: var(--text-light);
            margin: 0 0 15px 0;
            line-height: 1.5;
        }

        .access-code {
            background: var(--background-light);
            border: 2px solid var(--primary-purple);
            border-radius: 12px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-purple);
            text-align: center;
            letter-spacing: 2px;
        }

        .privacy-info a {
            color: var(--primary-purple);
            text-decoration: none;
            font-weight: 600;
        }

        .privacy-info a:hover {
            text-decoration: underline;
        }

        /* Progress Chart Styles */
        .progress-chart {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--shadow);
            margin-bottom: 20px;
        }

        .chart-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-family: 'Fredoka One', cursive;
            font-size: 16px;
            color: var(--text-dark);
            margin: 0;
        }

        .chart-period {
            font-size: 12px;
            color: var(--text-light);
            background: var(--background-light);
            padding: 4px 8px;
            border-radius: 6px;
        }

        /* Enhanced Mobile Responsive Design */
        
        /* Mobile Header & Navigation */
        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .logo {
                font-size: 20px;
                flex: 1;
            }
            
            .user-info {
                order: 3;
                width: 100%;
                margin-top: 10px;
                justify-content: space-between;
            }
            
            .club-selector {
                order: 2;
            }
            
            .club-selector select {
                font-size: 14px;
                padding: 8px 12px;
            }
            
            /* Mobile Navigation */
            .sidebar {
                order: 2;
                background: var(--white);
                border-radius: 16px 16px 0 0;
                margin-top: 20px;
                padding: 20px;
                box-shadow: 0 -4px 15px var(--shadow);
            }
            
            .nav-links {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .nav-link {
                padding: 12px;
                text-align: center;
                font-size: 13px;
                border-radius: 12px;
            }
            
            /* Mobile Dashboard */
            .dashboard {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .main-content {
                order: 1;
            }
            
            /* Mobile Content Areas */
            .content-area {
                padding: 20px;
            }
            
            .content-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                text-align: left;
            }
            
            .content-title {
                font-size: 24px;
                line-height: 1.2;
            }
            
            .content-subtitle {
                font-size: 14px;
            }
            
            .privacy-badge {
                align-self: flex-start;
            }
            
            /* Mobile Content Grids */
            .content-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .content-preview-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .upload-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            /* Mobile Cards */
            .content-card {
                padding: 20px;
                min-height: auto;
            }
            
            .content-card.enhanced {
                padding: 25px;
                min-height: auto;
            }
            
            .card-icon {
                font-size: 36px;
                margin-bottom: 12px;
            }
            
            .card-title {
                font-size: 18px;
                margin-bottom: 8px;
            }
            
            .card-description {
                font-size: 13px;
                line-height: 1.5;
                margin-bottom: 15px;
            }
            
            .card-meta {
                flex-wrap: wrap;
                gap: 6px;
                margin-bottom: 15px;
            }
            
            .card-meta span {
                font-size: 10px;
                padding: 4px 8px;
            }
            
            .card-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn {
                width: 100%;
                text-align: center;
                padding: 12px 16px;
            }
            
            .btn-sm {
                padding: 10px 14px;
                font-size: 13px;
            }
            
            .btn-xs {
                padding: 8px 12px;
                font-size: 11px;
            }
            
            /* Mobile Club Selection */
            .club-boxes {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .club-box {
                padding: 20px;
                text-align: center;
            }
            
            .club-emoji {
                font-size: 48px;
                margin-bottom: 15px;
            }
            
            .club-title {
                font-size: 20px;
            }
            
            .club-subtitle {
                font-size: 13px;
            }
            
            /* Student Portal Mobile */
            .consent-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .consent-icon {
                font-size: 28px;
            }
            
            .consent-text h4 {
                font-size: 16px;
            }
            
            .consent-text p {
                font-size: 13px;
            }
            
            .consent-actions {
                justify-content: center;
                flex-direction: column;
                gap: 8px;
            }
            
            .consent-actions .btn {
                width: 100%;
            }
            
            .parent-access-card {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .access-code {
                font-size: 16px;
                padding: 12px;
                letter-spacing: 1px;
            }
            
            /* Mobile Enhanced Upload Sections */
            .enhanced-upload-section {
                margin-top: 25px;
                padding: 20px;
                border-radius: 12px;
            }
            
            .upload-section-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
                gap: 10px;
                margin-bottom: 15px;
            }
            
            .upload-section-icon {
                font-size: 28px;
                width: 50px;
                height: 50px;
                border-radius: 12px;
            }
            
            .upload-section-info h3 {
                font-size: 18px;
                margin-bottom: 5px;
            }
            
            .upload-section-info p {
                font-size: 13px;
            }
            
            .stat-item {
                padding: 12px;
                border-radius: 10px;
            }
            
            .stat-number {
                font-size: 20px;
                margin-bottom: 4px;
            }
            
            .stat-label {
                font-size: 10px;
            }
        }

        /* Tablet Optimization */
        @media (min-width: 769px) and (max-width: 1024px) {
            .content-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .content-preview-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .upload-stats {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .nav-links {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }
            
            .club-boxes {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Extra Small Screens */
        @media (max-width: 480px) {
            .header {
                padding: 12px 15px;
            }
            
            .logo {
                font-size: 18px;
            }
            
            .dashboard {
                padding: 15px;
                gap: 15px;
            }
            
            .content-area {
                padding: 15px;
            }
            
            .content-title {
                font-size: 20px;
            }
            
            .content-card {
                padding: 15px;
            }
            
            .content-card.enhanced {
                padding: 18px;
            }
            
            .card-icon {
                font-size: 32px;
            }
            
            .card-title {
                font-size: 16px;
            }
            
            .card-description {
                font-size: 12px;
            }
            
            .upload-stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .enhanced-upload-section {
                padding: 15px;
                margin-top: 20px;
            }
            
            .upload-section-icon {
                width: 40px;
                height: 40px;
                font-size: 24px;
            }
            
            .upload-section-info h3 {
                font-size: 16px;
            }
            
            .upload-section-info p {
                font-size: 12px;
            }
        }

        /* Mobile Modal Optimizations */
        @media (max-width: 768px) {
            .modal {
                padding: 20px;
                align-items: flex-start;
                padding-top: 40px;
            }
            
            .modal-content {
                width: 100%;
                max-width: none;
                margin: 0;
                border-radius: 16px 16px 0 0;
                max-height: 90vh;
                overflow-y: auto;
            }
            
            .modal-header {
                padding: 20px;
                border-bottom: 1px solid var(--border-light);
                position: sticky;
                top: 0;
                background: var(--white);
                z-index: 10;
            }
            
            .modal-header h3 {
                font-size: 18px;
                margin: 0;
            }
            
            .close-button {
                font-size: 24px;
                width: 32px;
                height: 32px;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .modal-footer {
                padding: 20px;
                border-top: 1px solid var(--border-light);
                position: sticky;
                bottom: 0;
                background: var(--white);
                z-index: 10;
            }
            
            /* Mobile Upload Areas */
            .file-upload-area {
                padding: 30px 20px;
                border-radius: 12px;
                min-height: 120px;
            }
            
            .file-upload-icon {
                font-size: 32px;
                margin-bottom: 10px;
            }
            
            .file-upload-text {
                font-size: 14px;
                margin-bottom: 8px;
            }
            
            .file-upload-hint {
                font-size: 11px;
            }
            
            /* Mobile Form Elements */
            .form-group {
                margin-bottom: 20px;
            }
            
            .form-group label {
                font-size: 14px;
                margin-bottom: 8px;
            }
            
            .form-group select,
            .form-group input {
                padding: 12px;
                font-size: 14px;
                border-radius: 8px;
            }
            
            .file-list {
                margin-top: 15px;
            }
            
            .file-item {
                padding: 10px;
                font-size: 12px;
                border-radius: 6px;
            }
            
            .progress-bar {
                height: 6px;
                border-radius: 3px;
                margin: 8px 0;
            }
            
            .upload-results {
                padding: 15px;
                border-radius: 8px;
                margin-top: 15px;
            }
        }

        /* Touch-Friendly Interactions */
        @media (max-width: 768px) {
            .content-card,
            .content-preview-card,
            .nav-link,
            .btn {
                transition: all 0.2s ease;
            }
            
            .content-card:active,
            .content-preview-card:active,
            .nav-link:active,
            .btn:active {
                transform: scale(0.98);
                opacity: 0.8;
            }
            
            /* Larger touch targets */
            .btn {
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .nav-link {
                min-height: 48px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* Swipe indicators for horizontal scrolling */
            .horizontal-scroll {
                overflow-x: auto;
                scroll-snap-type: x mandatory;
                -webkit-overflow-scrolling: touch;
            }
            
            .horizontal-scroll::-webkit-scrollbar {
                height: 3px;
            }
            
            .horizontal-scroll::-webkit-scrollbar-track {
                background: var(--background-light);
            }
            
            .horizontal-scroll::-webkit-scrollbar-thumb {
                background: var(--border-light);
                border-radius: 3px;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--white);
            border-radius: 25px;
            padding: 0;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 60px var(--shadow-hover);
            position: relative;
            animation: fadeInUp 0.3s ease;
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 2px solid var(--bg-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-family: 'Fredoka One', cursive;
            color: var(--primary-purple);
            font-size: 24px;
            margin: 0;
        }

        .modal-close {
            font-size: 28px;
            font-weight: bold;
            color: var(--text-light);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--primary-purple);
            background: rgba(139, 95, 191, 0.1);
            border-radius: 50%;
        }

        /* Force close button for stuck modals */
        .force-close-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            background: var(--coral-pink);
            color: var(--white);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.4);
        }

        .modal-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-select, .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--bg-light);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .form-select:focus, .form-input:focus {
            outline: none;
            border-color: var(--primary-purple);
            box-shadow: 0 0 0 3px rgba(139, 95, 191, 0.1);
        }

        .file-upload-area {
            border: 2px dashed var(--primary-purple);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            background: rgba(139, 95, 191, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            background: rgba(139, 95, 191, 0.1);
        }

        .file-upload-area.drag-over {
            border-color: var(--grass-green);
            background: rgba(107, 207, 127, 0.1);
        }

        .file-upload-icon {
            font-size: 48px;
            color: var(--primary-purple);
            margin-bottom: 15px;
        }

        .file-upload-text {
            color: var(--text-medium);
            font-size: 16px;
            margin-bottom: 10px;
        }

        .file-upload-hint {
            color: var(--text-light);
            font-size: 14px;
        }

        .file-list {
            margin-top: 20px;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--bg-light);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-icon {
            font-size: 18px;
        }

        .file-remove {
            color: var(--coral-pink);
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .file-remove:hover {
            background: rgba(255, 107, 157, 0.1);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--bg-light);
        }

        .upload-progress {
            margin-top: 25px;
            padding: 20px;
            background: var(--bg-light);
            border-radius: 12px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--grass-green), #52C41A);
            transition: width 0.3s ease;
        }

        .upload-results {
            margin-top: 25px;
            padding: 20px;
            border-radius: 12px;
        }

        .upload-results.success {
            background: rgba(107, 207, 127, 0.1);
            border: 2px solid var(--grass-green);
            color: #22543d;
        }

        .upload-results.error {
            background: rgba(255, 107, 157, 0.1);
            border: 2px solid var(--coral-pink);
            color: #742a2a;
        }

        .results-list {
            margin-top: 15px;
        }

        .result-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-status {
            font-size: 16px;
        }

        /* ============================================ */
        /* FEEDBACK TOAST & INTERACTIVE ELEMENTS */
        /* ============================================ */
        
        .feedback-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 10000;
            display: none;
            align-items: center;
            gap: 10px;
            max-width: 300px;
        }
        
        .feedback-toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .feedback-toast.success {
            background: linear-gradient(135deg, var(--success-green), #27ae60);
        }
        
        .feedback-toast.error {
            background: linear-gradient(135deg, var(--coral-pink), #e74c3c);
        }
        
        .feedback-toast.info {
            background: linear-gradient(135deg, var(--sage-green), #3498db);
        }
        
        .feedback-toast::before {
            content: '✓';
            font-size: 18px;
        }
        
        .feedback-toast.error::before {
            content: '✕';
        }
        
        .feedback-toast.info::before {
            content: 'ℹ';
        }

        /* Click ripple effect */
        .click-ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: scale(0);
            animation: ripple 0.6s ease-out;
            pointer-events: none;
        }
        
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Enhanced hover states */
        .hover-lift {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px var(--shadow-hover);
        }
        
        .btn-pressed {
            transform: scale(0.95);
        }
        
        .input-focused {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(139, 185, 139, 0.3);
        }
        
        /* Scroll-triggered animations */
        .animate-in {
            animation: slideInUp 0.6s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Upload status animations */
        .upload-uploading {
            animation: pulse 1.5s infinite;
        }
        
        .upload-success {
            animation: successFlash 0.5s ease-out;
        }
        
        .upload-error {
            animation: errorShake 0.5s ease-out;
        }
        
        @keyframes successFlash {
            0%, 100% { background: transparent; }
            50% { background: rgba(39, 174, 96, 0.2); }
        }
        
        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body oncontextmenu="return false;" ondragstart="return false;" onselectstart="return false;">
    <div id="app"></div>

    <script>
        // ============================================
        // AZURE B2C CONFIGURATION (keeping existing)
        // ============================================
        
        const B2C_CONFIG = {
            tenantName: "brightstars11plus",
            tenantId: "d96d2f4e-d080-4c2f-90e1-cce96e64b6ba",
            clientId: "a4f6894b-e8f4-4102-a777-63d749372a6b",
            signInSignUpPolicyName: "SignUpSignIn",
            redirectUri: window.location.origin,
            scopes: ["openid", "profile"],
            cacheLocation: "sessionStorage",
            isConfigured: true
        };

        const getAuthority = () => {
            return `https://${B2C_CONFIG.tenantName}.ciamlogin.com/${B2C_CONFIG.tenantId}`;
        };

        // ============================================
        // APPLICATION STATE
        // ============================================
        
        let msalInstance = null;
        let currentAccount = null;
        let userIsAdmin = false;
        let userApprovalStatus = 'pending';
        let userHasSubscription = false;
        let selectedClub = null; // 'year4' or 'year5'
        let currentView = 'overview';
        let statusMessage = "";
        let statusType = "";

        // ============================================
        // INITIALIZATION FUNCTIONS (keeping existing MSAL setup)
        // ============================================
        
        function initializeMSAL() {
            if (!B2C_CONFIG.isConfigured) {
                console.log("B2C not configured yet");
                return false;
            }

            try {
                const msalConfig = {
                    auth: {
                        clientId: B2C_CONFIG.clientId,
                        authority: getAuthority(),
                        knownAuthorities: [`${B2C_CONFIG.tenantName}.ciamlogin.com`],
                        redirectUri: B2C_CONFIG.redirectUri,
                        postLogoutRedirectUri: B2C_CONFIG.redirectUri,
                        navigateToLoginRequestUrl: false
                    },
                    cache: {
                        cacheLocation: B2C_CONFIG.cacheLocation,
                        storeAuthStateInCookie: false
                    }
                };

                msalInstance = new msal.PublicClientApplication(msalConfig);
                return true;
            } catch (error) {
                console.error("Error initializing MSAL:", error);
                return false;
            }
        }

        async function signIn() {
            if (!msalInstance) {
                showStatus("Please configure Azure B2C settings first", "error");
                return;
            }

            try {
                showStatus("Redirecting to login...", "info");
                
                const loginRequest = {
                    scopes: B2C_CONFIG.scopes,
                    extraQueryParameters: {
                        p: B2C_CONFIG.signInSignUpPolicyName
                    },
                    prompt: "select_account"
                };

                await msalInstance.loginRedirect(loginRequest);
                
            } catch (error) {
                console.error("Login error:", error);
                showStatus(`Login failed: ${error.message}`, "error");
            }
        }

        async function signOut() {
            if (!msalInstance) return;

            try {
                const logoutRequest = {
                    postLogoutRedirectUri: B2C_CONFIG.redirectUri,
                    mainWindowRedirectUri: B2C_CONFIG.redirectUri
                };

                await msalInstance.logoutRedirect(logoutRequest);
                currentAccount = null;
                selectedClub = null;
                render();
            } catch (error) {
                console.error("Logout error:", error);
            }
        }

        async function handleAuthResponse(response) {
            if (response && response.account) {
                currentAccount = response.account;
                
                const email = response.account.username || response.account.idTokenClaims?.emails?.[0];
                const name = response.account.name || response.account.idTokenClaims?.name || '';
                
                console.log("User logged in:", email);
                
                // For demo purposes, simulate admin check and subscription status
                userIsAdmin = response.account.idTokenClaims?.roles?.includes('isAdmin') || false;
                userApprovalStatus = 'approved'; // Simulate approved status
                userHasSubscription = true; // Simulate active subscription
                
                showStatus(`Successfully logged in as ${email}`, 'success');
                
                setTimeout(() => {
                    render();
                }, 1500);
            }
        }

        async function checkExistingLogin() {
            if (!msalInstance) return;

            try {
                const accounts = msalInstance.getAllAccounts();
                if (accounts.length > 0) {
                    currentAccount = accounts[0];
                    
                    try {
                        const response = await msalInstance.acquireTokenSilent({
                            scopes: B2C_CONFIG.scopes,
                            account: accounts[0]
                        });
                        
                        if (response.accessToken) {
                            console.log("User already logged in:", accounts[0].username);
                            await handleAuthResponse({ account: accounts[0] });
                        }
                    } catch (error) {
                        currentAccount = null;
                        render();
                    }
                }
            } catch (error) {
                console.error("Error checking existing login:", error);
            }
        }

        // ============================================
        // UI FUNCTIONS
        // ============================================
        
        function showStatus(message, type = "info") {
            statusMessage = message;
            statusType = type;
            render();
        }

        function selectClub(club) {
            selectedClub = club;
            currentView = 'overview';
            render();
        }

        function YrClubSelection() {
            selectedClub = null;
            currentView = 'overview';
            render();
        }

        function setCurrentView(view) {
            currentView = view;
            render();
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================
        
        function render() {
            const app = document.getElementById('app');
            
            if (!currentAccount) {
                app.innerHTML = renderLogin();
            } else if (userApprovalStatus !== 'approved') {
                app.innerHTML = renderPendingApproval();
            } else if (!selectedClub) {
                app.innerHTML = renderClubSelection();
            } else {
                app.innerHTML = renderDashboard();
            }
            
            // After rendering, ensure any modals are properly hidden
            setTimeout(() => {
                const modal = document.getElementById('bulkUploadModal');
                if (modal && currentView !== 'admin-lessons') {
                    modal.classList.add('hidden');
                    modal.style.display = 'none';
                }
            }, 100);
        }

        function renderLogin() {
            return `
                <div class="auth-container fade-in-up">
                    <h2>11+ Learning Platform</h2>
                    
                    ${statusMessage ? `
                        <div class="auth-status ${statusType}">
                            ${statusMessage}
                            ${statusType === 'info' ? '<span class="loading"></span>' : ''}
                        </div>
                    ` : ''}
                    
                    <img src="/images/bright-stars-logo.png" alt="Bright Stars Education" class="auth-logo" />
                    
                    <button class="btn" onclick="signIn()" style="width: 100%; margin-bottom: 15px; font-size: 18px;">
                        Sign In to Start Learning
                    </button>
                    
                    <p style="text-align: center; color: var(--text-light); font-size: 14px;">
                        New families can sign up through the same button above
                    </p>
                </div>
            `;
        }

        function renderPendingApproval() {
            return `
                <div class="container">
                    <div class="header">
                        <div class="logo">
                            <img src="/images/bright-stars-logo.png" alt="Bright Stars Education" class="logo-image" />
                            <img src="/images/bright-stars-banner.png" alt="Bright Stars Education" class="logo-banner" />
                        </div>
                        <div class="user-info">
                            <button class="btn btn-secondary" onclick="signOut()">Logout</button>
                        </div>
                    </div>
                    
                    <div style="background: var(--white); border-radius: 25px; padding: 50px; text-align: center; box-shadow: 0 20px 60px var(--shadow);">
                        <div style="font-size: 64px; margin-bottom: 20px;">⏳</div>
                        <h2 style="font-family: 'Fredoka One', cursive; color: var(--primary-purple); margin-bottom: 15px;">Account Under Review</h2>
                        <p style="color: var(--text-medium); font-size: 18px;">Your account is being reviewed by our team.</p>
                        <p style="color: var(--text-light);">You'll receive an email once your account has been approved.</p>
                    </div>
                </div>
            `;
        }

        function renderClubSelection() {
            const username = currentAccount?.name || currentAccount?.username || "User";
            
            return `
                <div class="container">
                    <div class="header">
                        <div class="logo">
                            <img src="/images/bright-stars-logo.png" alt="Bright Stars Education" class="logo-image" />
                            <img src="/images/bright-stars-banner.png" alt="Bright Stars Education" class="logo-banner" />
                        </div>
                        <div class="user-info">
                            ${userHasSubscription ? 
                                '<span class="subscription-badge">Active Subscription</span>' :
                                '<span class="subscription-badge inactive">No Subscription</span>'
                            }
                            <span style="color: var(--text-medium); font-weight: 600;">Welcome, ${username}!</span>
                            <button class="btn btn-secondary" onclick="signOut()">Logout</button>
                        </div>
                    </div>

                    <div class="club-selection fade-in-up">
                        <div>
                            <h1 class="club-selection-title">Choose Your Learning Path</h1>
                            <p class="club-selection-subtitle">Select the program that's right for your child's year group</p>
                        </div>
                        
                        <div class="club-boxes">
                            <div class="club-box year4" onclick="selectClub('year4')">
                                <div class="club-icon">🎓</div>
                                <h3 class="club-title">Year 4</h3>
                                <p class="club-subtitle">11+ Prep Club</p>
                                <p class="club-description">
                                    Foundation preparation for children in Year 4, building essential skills 
                                    for the 11+ journey ahead with engaging lessons and activities.
                                </p>
                            </div>
                            
                            <div class="club-box year5" onclick="selectClub('year5')">
                                <div class="club-icon">🚀</div>
                                <h3 class="club-title">Year 5</h3>
                                <p class="club-subtitle">11+ Club</p>
                                <p class="club-description">
                                    Intensive 11+ preparation for Year 5 children, covering advanced topics 
                                    and exam techniques to excel in their 11+ assessments.
                                </p>
                            </div>
                        </div>
                        
                        ${userIsAdmin ? `
                            <div style="margin-top: 40px;">
                                <button class="btn btn-secondary" onclick="alert('Admin panel coming in next phase!')">
                                    🛡️ Admin Panel
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderDashboard() {
            return `
                <div class="container">
                    <div class="header">
                        <div class="logo">
                            <img src="/images/bright-stars-logo.png" alt="Bright Stars Education" class="logo-image" />
                            <img src="/images/bright-stars-banner.png" alt="Bright Stars Education" class="logo-banner" />
                        </div>
                        <div class="user-info">
                            ${userHasSubscription ? 
                                '<span class="subscription-badge">Active Subscription</span>' :
                                '<span class="subscription-badge inactive">No Subscription</span>'
                            }
                            <button class="btn btn-secondary" onclick="signOut()">Logout</button>
                        </div>
                    </div>

                    <div class="dashboard fade-in-up">
                        ${renderSidebar()}
                        ${renderContentArea()}
                    </div>
                </div>
            `;
        }

        function renderSidebar() {
            const clubInfo = selectedClub === 'year4' ? 
                { title: 'Year 4 - 11+ Prep Club', subtitle: 'Foundation preparation program' } :
                { title: 'Year 5 - 11+ Club', subtitle: 'Intensive preparation program' };

            const navItems = selectedClub === 'year4' ? 
                [
                    { id: 'overview', icon: '🏠', label: 'Overview' },
                    { id: 'year-ahead', icon: '📅', label: 'The Year Ahead' },
                    { id: 'maths-syllabus', icon: '🔢', label: 'Maths Syllabus' },
                    { id: 'english-syllabus', icon: '📚', label: 'English Syllabus' },
                    { id: 'extra-resources', icon: '🎯', label: 'Extra Teaching Resources' },
                    { id: 'student-area', icon: '👨‍🎓', label: 'Student Area' },
                    { id: 'subscription', icon: '💳', label: 'Subscription Info' }
                ] :
                [
                    { id: 'overview', icon: '🏠', label: 'Overview' },
                    { id: 'year-ahead', icon: '📅', label: 'The Year Ahead' },
                    { id: 'maths-syllabus', icon: '🔢', label: 'Maths Syllabus' },
                    { id: 'english-syllabus', icon: '📚', label: 'English Syllabus' },
                    { id: 'extra-resources', icon: '🎯', label: 'Extra Teaching Resources' },
                    { id: 'student-area', icon: '👨‍🎓', label: 'Student Area' },
                    { id: 'subscription', icon: '💳', label: 'Subscription Info' }
                ];

            return `
                <div class="sidebar">
                    <button class="back-to-clubs" onclick="YrClubSelection()">
                        ← Back to Club Selection
                    </button>
                    
                    <div class="sidebar-header">
                        <h3 class="sidebar-title">${clubInfo.title}</h3>
                        <p class="sidebar-subtitle">${clubInfo.subtitle}</p>
                    </div>
                    
                    <div class="nav-section">
                        ${navItems.map(item => `
                            <div class="nav-item ${currentView === item.id ? 'active' : ''}" 
                                 onclick="setCurrentView('${item.id}')">
                                <span class="nav-item-icon">${item.icon}</span>
                                <span>${item.label}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${userIsAdmin ? `
                        <div class="nav-section">
                            <div class="nav-section-title">Admin Tools</div>
                            <div class="nav-item" onclick="setCurrentView('admin-lessons')">
                                <span class="nav-item-icon">⚙️</span>
                                <span>Manage Lessons</span>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderContentArea() {
            switch (currentView) {
                case 'overview':
                    return renderOverview();
                case 'year-ahead':
                    return renderYearAhead();
                case 'maths-syllabus':
                    return renderMathsSyllabus();
                case 'english-syllabus':
                    return renderEnglishSyllabus();
                case 'extra-resources':
                    return renderExtraResources();
                case 'student-area':
                    setTimeout(() => initializeStudentPortal(), 100); // Initialize after DOM renders
                    return renderStudentArea();
                case 'subscription':
                    return renderSubscription();
                case 'admin-lessons':
                    return renderAdminLessons();
                default:
                    return renderOverview();
            }
        }

        function renderOverview() {
            const clubType = selectedClub === 'year4' ? 'Year 4 11+ Prep Club' : 'Year 5 11+ Club';
            
            return `
                <div class="content-area">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Welcome to ${clubType}</h1>
                            <p class="content-subtitle">Everything you need for 11+ success</p>
                        </div>
                    </div>
                    
                    <div class="content-grid">
                        <div class="content-card planning" onclick="setCurrentView('year-ahead')">
                            <span class="card-icon">📅</span>
                            <h3 class="card-title">The Year Ahead</h3>
                            <p class="card-description">
                                View your structured learning plan with weekly topics and milestones 
                                designed to build confidence and skills progressively.
                            </p>
                            <div class="card-meta">
                                <span>📊 44 Week Plan</span>
                                <span>🎯 Goal-Oriented</span>
                            </div>
                        </div>
                        
                        <div class="content-card maths" onclick="setCurrentView('maths-syllabus')">
                            <span class="card-icon">🔢</span>
                            <h3 class="card-title">Maths Syllabus</h3>
                            <p class="card-description">
                                Comprehensive maths lessons covering all 11+ topics with practice 
                                worksheets, homework sheets, and step-by-step guides.
                            </p>
                            <div class="card-meta">
                                <span>📚 Topic-Based</span>
                                <span>✏️ Practice Sheets</span>
                            </div>
                        </div>
                        
                        <div class="content-card english" onclick="setCurrentView('english-syllabus')">
                            <span class="card-icon">📚</span>
                            <h3 class="card-title">English Syllabus</h3>
                            <p class="card-description">
                                Master English skills with structured lessons covering comprehension, 
                                creative writing, grammar, and vocabulary building.
                            </p>
                            <div class="card-meta">
                                <span>✍️ Writing Skills</span>
                                <span>📖 Comprehension</span>
                            </div>
                        </div>
                        
                        <div class="content-card resources" onclick="setCurrentView('extra-resources')">
                            <span class="card-icon">🎯</span>
                            <h3 class="card-title">Extra Resources</h3>
                            <p class="card-description">
                                Additional materials including topic videos, past papers, worked 
                                examples, and reading lists to enhance learning.
                            </p>
                            <div class="card-meta">
                                <span>🎥 Videos</span>
                                <span>📄 Past Papers</span>
                            </div>
                        </div>
                        
                        ${selectedClub === 'year5' ? `
                            <div class="content-card" style="border-left: 5px solid var(--primary-purple);" onclick="setCurrentView('student-area')">
                                <span class="card-icon" style="color: var(--primary-purple);">👨‍🎓</span>
                                <h3 class="card-title">Student Area</h3>
                                <p class="card-description">
                                    Track progress, access homework assignments, and view test 
                                    scores in a secure, GDPR-compliant environment.
                                </p>
                                <div class="card-meta">
                                    <span>📊 Progress Tracking</span>
                                    <span>🔒 Secure Access</span>
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="content-card" style="border-left: 5px solid var(--sunny-yellow);" onclick="setCurrentView('subscription')">
                            <span class="card-icon" style="color: var(--sunny-yellow);">💳</span>
                            <h3 class="card-title">Subscription</h3>
                            <p class="card-description">
                                Manage your subscription, update payment methods, and view 
                                billing history for your learning platform access.
                            </p>
                            <div class="card-meta">
                                <span>✅ Active Plan</span>
                                <span>🔄 Auto-Renewal</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderYearAhead() {
            return `
                <div class="content-area">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">The Year Ahead</h1>
                            <p class="content-subtitle">Your structured 44-week learning journey</p>
                        </div>
                    </div>
                    
                    <div class="coming-soon">
                        <div class="coming-soon-icon">📅</div>
                        <h3>Teaching Plan Coming Soon!</h3>
                        <p>
                            We're preparing your comprehensive year-long teaching plan with weekly 
                            topics, milestones, and structured learning objectives. This will help 
                            you track progress and stay on target for 11+ success.
                        </p>
                    </div>
                    
                    ${userIsAdmin ? `
                        <div class="bulk-upload-section">
                            <h4>📋 Admin: Upload Year Plan</h4>
                            <p>Upload the spreadsheet with the year-ahead teaching plan for ${selectedClub === 'year4' ? 'Year 4' : 'Year 5'}.</p>
                            <button class="btn" onclick="showBulkUploadForm('year-plan')">
                                📁 Upload Teaching Plan
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderMathsSyllabus() {
            return `
                <div class="content-area">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Maths Syllabus</h1>
                            <p class="content-subtitle">Topic-based lesson plans and resources</p>
                        </div>
                    </div>
                    
                    <div class="content-grid">
                        <div class="content-card enhanced maths">
                            <span class="card-icon">➕</span>
                            <h3 class="card-title">Number & Algebra</h3>
                            <p class="card-description">
                                Master arithmetic operations, fractions, decimals, and basic algebra 
                                concepts essential for 11+ success.
                            </p>
                            <div class="card-meta">
                                <span>📊 12 Topics</span>
                                <span>🎯 Practice Tests</span>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="loadMathsTopic('number-algebra')">
                                    📖 Explore Topics
                                </button>
                            </div>
                        </div>
                        
                        <div class="content-card enhanced maths">
                            <span class="card-icon">📐</span>
                            <h3 class="card-title">Geometry & Measures</h3>
                            <p class="card-description">
                                Learn shapes, angles, area, perimeter, and measurement units with 
                                visual exercises and problem-solving techniques.
                            </p>
                            <div class="card-meta">
                                <span>📊 8 Topics</span>
                                <span>📏 Visual Aids</span>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="loadMathsTopic('geometry-measures')">
                                    📖 Explore Topics
                                </button>
                            </div>
                        </div>
                        
                        <div class="content-card enhanced maths">
                            <span class="card-icon">📊</span>
                            <h3 class="card-title">Data & Statistics</h3>
                            <p class="card-description">
                                Understand charts, graphs, probability, and data interpretation 
                                skills commonly tested in 11+ exams.
                            </p>
                            <div class="card-meta">
                                <span>📊 6 Topics</span>
                                <span>📈 Real Examples</span>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="loadMathsTopic('data-statistics')">
                                    📖 Explore Topics
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Content Preview Section -->
                    <div class="enhanced-upload-section">
                        <div class="upload-section-header">
                            <div class="upload-section-icon" style="color: var(--bright-orange);">🔢</div>
                            <div class="upload-section-info">
                                <h3>Maths Content Library</h3>
                                <p>Lesson plans, worksheets, and video tutorials organized by topic</p>
                            </div>
                        </div>
                        
                        <div class="upload-stats">
                            <div class="stat-item">
                                <div class="stat-number">26</div>
                                <div class="stat-label">Topics</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">180</div>
                                <div class="stat-label">Worksheets</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">45</div>
                                <div class="stat-label">Videos</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">15</div>
                                <div class="stat-label">Mock Tests</div>
                            </div>
                        </div>
                        
                        <div id="mathsContentPreview" class="content-preview-grid">
                            <!-- Maths content previews will be loaded here -->
                        </div>
                    </div>
                    
                    ${userIsAdmin ? `
                        <div class="bulk-upload-section">
                            <h4>🔢 Admin: Upload Maths Content</h4>
                            <p>Bulk upload maths lesson plans, worksheets, and resources organized by topic.</p>
                            <button class="btn" onclick="showBulkUploadForm('bulk-lessons')">
                                📁 Upload Maths Syllabus
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderEnglishSyllabus() {
            return `
                <div class="content-area">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">English Syllabus</h1>
                            <p class="content-subtitle">Comprehensive English language and literature</p>
                        </div>
                    </div>
                    
                    <div class="content-grid">
                        <div class="content-card enhanced english">
                            <span class="card-icon">📖</span>
                            <h3 class="card-title">Reading & Comprehension</h3>
                            <p class="card-description">
                                Develop critical reading skills with diverse texts, inference questions, 
                                and comprehension strategies for 11+ success.
                            </p>
                            <div class="card-meta">
                                <span>📚 20 Texts</span>
                                <span>❓ Question Types</span>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="loadEnglishTopic('reading-comprehension')">
                                    📖 Start Reading
                                </button>
                            </div>
                        </div>
                        
                        <div class="content-card enhanced english">
                            <span class="card-icon">✍️</span>
                            <h3 class="card-title">Creative Writing</h3>
                            <p class="card-description">
                                Master storytelling techniques, descriptive writing, and creative 
                                expression through structured exercises and prompts.
                            </p>
                            <div class="card-meta">
                                <span>✏️ Writing Prompts</span>
                                <span>🎨 Story Types</span>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="loadEnglishTopic('creative-writing')">
                                    ✍️ Start Writing
                                </button>
                            </div>
                        </div>
                        
                        <div class="content-card enhanced english">
                            <span class="card-icon">📝</span>
                            <h3 class="card-title">Grammar & Language</h3>
                            <p class="card-description">
                                Build strong grammar foundations with interactive exercises covering 
                                punctuation, sentence structure, and vocabulary.
                            </p>
                            <div class="card-meta">
                                <span>📚 Grammar Rules</span>
                                <span>🔤 Vocabulary</span>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="loadEnglishTopic('grammar-language')">
                                    📝 Practice Grammar
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Content Preview Section -->
                    <div class="enhanced-upload-section">
                        <div class="upload-section-header">
                            <div class="upload-section-icon" style="color: var(--grass-green);">📚</div>
                            <div class="upload-section-info">
                                <h3>English Content Library</h3>
                                <p>Texts, writing prompts, grammar exercises, and vocabulary builders</p>
                            </div>
                        </div>
                        
                        <div class="upload-stats">
                            <div class="stat-item">
                                <div class="stat-number">35</div>
                                <div class="stat-label">Reading Texts</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">120</div>
                                <div class="stat-label">Writing Prompts</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">80</div>
                                <div class="stat-label">Grammar Exercises</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">12</div>
                                <div class="stat-label">Mock Tests</div>
                            </div>
                        </div>
                        
                        <div id="englishContentPreview" class="content-preview-grid">
                            <!-- English content previews will be loaded here -->
                        </div>
                    </div>
                    
                    ${userIsAdmin ? `
                        <div class="bulk-upload-section">
                            <h4>📚 Admin: Upload English Content</h4>
                            <p>Bulk upload English lesson plans, comprehension exercises, and writing resources.</p>
                            <button class="btn" onclick="showBulkUploadForm('bulk-lessons')">
                                📁 Upload English Syllabus
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderExtraResources() {
    return `
        <div class="content-area">
            <div class="content-header">
                <div>
                    <h1 class="content-title">Extra Teaching Resources</h1>
                    <p class="content-subtitle">Additional materials to enhance learning</p>
                </div>
            </div>
            
            <div class="content-grid">
                <div class="content-card maths">
                    <span class="card-icon">🎥</span>
                    <h3 class="card-title">Maths Topic Videos</h3>
                    <p class="card-description">Visual explanations of key mathematical concepts</p>
                    <div class="card-meta"><span>Coming Soon</span></div>
                </div>
                
                <div class="content-card english">
                    <span class="card-icon">📝</span>
                    <h3 class="card-title">English How-To Guides</h3>
                    <p class="card-description">Step-by-step writing and comprehension guides</p>
                    <div class="card-meta"><span>Coming Soon</span></div>
                </div>
                
                ${selectedClub === 'year5' ? `
                    <div class="content-card resources">
                        <span class="card-icon">📄</span>
                        <h3 class="card-title">CSSE Past Papers</h3>
                        <p class="card-description">Historical exam papers for practice</p>
                        <div class="card-meta"><span>Coming Soon</span></div>
                    </div>
                    
                    <div class="content-card resources">
                        <span class="card-icon">✏️</span>
                        <h3 class="card-title">CSSE Worked Examples</h3>
                        <p class="card-description">Detailed solutions to past paper questions</p>
                        <div class="card-meta"><span>Coming Soon</span></div>
                    </div>
                ` : ''}
                
                <div class="content-card planning">
                    <span class="card-icon">📚</span>
                    <h3 class="card-title">Recommended Reading</h3>
                    <p class="card-description">Curated book lists to enhance learning</p>
                    <div class="card-meta"><span>Coming Soon</span></div>
                </div>
                
                <div class="content-card english">
                    <span class="card-icon">✍️</span>
                    <h3 class="card-title">Writing Prompts</h3>
                    <p class="card-description">Creative writing exercises and prompts</p>
                    <div class="card-meta"><span>Coming Soon</span></div>
                </div>
                
                <div class="content-card english">
                    <span class="card-icon">📖</span>
                    <h3 class="card-title">Comprehension Tasks</h3>
                    <p class="card-description">CSSE-style comprehension exercises</p>
                    <div class="card-meta"><span>Coming Soon</span></div>
                </div>
                
                <div class="content-card resources">
                    <span class="card-icon">🔗</span>
                    <h3 class="card-title">Useful Website Links</h3>
                    <p class="card-description">Educational websites and online resources</p>
                    <div class="card-meta"><span>Coming Soon</span></div>
                </div>
            </div>
            
            ${userIsAdmin ? `
                <div class="bulk-upload-section">
                    <h4>🎯 Admin: Upload Extra Resources</h4>
                    <p>Bulk upload videos, past papers, reading lists, and other supplementary materials.</p>
                    <button class="btn" onclick="showBulkUploadForm('resources')">
                        📁 Upload Resources
                    </button>
                </div>
            ` : ''}
        </div>
    `;
}

        function renderStudentArea() {
    return `
        <div class="content-area">
            <div class="content-header">
                <div>
                    <h1 class="content-title">Student Progress Portal</h1>
                    <p class="content-subtitle">GDPR-compliant learning progress tracking</p>
                </div>
                <div class="privacy-badge">
                    🔒 Privacy Protected
                </div>
            </div>
            
            <!-- GDPR Consent Banner -->
            <div id="gdprConsentBanner" class="gdpr-consent-banner hidden">
                <div class="consent-content">
                    <div class="consent-icon">🔒</div>
                    <div class="consent-text">
                        <h4>Data Privacy Consent</h4>
                        <p>We need your consent to track and display your learning progress. Your data is secure and will only be used to help improve your education.</p>
                    </div>
                    <div class="consent-actions">
                        <button class="btn btn-sm" onclick="acceptGDPRConsent()">Accept</button>
                        <button class="btn btn-sm btn-secondary" onclick="declineGDPRConsent()">Decline</button>
                    </div>
                </div>
            </div>
            
            <!-- Progress Overview -->
            <div id="progressOverview" class="progress-overview">
                <div class="upload-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="totalAssignments">-</div>
                        <div class="stat-label">Total Assignments</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="completedAssignments">-</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="averageScore">-</div>
                        <div class="stat-label">Average Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="improvementTrend">📊</div>
                        <div class="stat-label">Trend</div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Grid -->
            <div class="content-grid">
                <div class="content-card enhanced" style="border-left: 5px solid var(--grass-green);">
                    <span class="card-icon" style="color: var(--grass-green);">📝</span>
                    <h3 class="card-title">My Homework</h3>
                    <p class="card-description">
                        Access your weekly assignments, submit completed work, and track your progress.
                    </p>
                    <div class="card-meta">
                        <span>📅 Weekly Tasks</span>
                        <span>⏰ Due Dates</span>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-sm" onclick="loadStudentHomework()">
                            📚 View Homework
                        </button>
                    </div>
                </div>
                
                <div class="content-card enhanced" style="border-left: 5px solid var(--primary-purple);">
                    <span class="card-icon" style="color: var(--primary-purple);">📊</span>
                    <h3 class="card-title">Progress Reports</h3>
                    <p class="card-description">
                        View detailed progress reports, test scores, and improvement areas identified by your teacher.
                    </p>
                    <div class="card-meta">
                        <span>📈 Performance</span>
                        <span>🎯 Goals</span>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-sm" onclick="loadProgressReports()">
                            📊 View Progress
                        </button>
                    </div>
                </div>
                
                <div class="content-card enhanced" style="border-left: 5px solid var(--bright-orange);">
                    <span class="card-icon" style="color: var(--bright-orange);">🏆</span>
                    <h3 class="card-title">Achievements</h3>
                    <p class="card-description">
                        Celebrate your learning milestones and achievements in your 11+ preparation journey.
                    </p>
                    <div class="card-meta">
                        <span>⭐ Milestones</span>
                        <span>🎖️ Badges</span>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-sm" onclick="loadAchievements()">
                            🏆 View Achievements
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Homework Submission Section -->
            <div class="enhanced-upload-section">
                <div class="upload-section-header">
                    <div class="upload-section-icon" style="color: var(--sky-blue);">📤</div>
                    <div class="upload-section-info">
                        <h3>Homework Submission</h3>
                        <p>Submit your completed assignments for teacher review</p>
                    </div>
                </div>
                
                <div id="homeworkSubmission" class="homework-submission-area">
                    <!-- Homework submission form will be loaded here -->
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="enhanced-upload-section">
                <div class="upload-section-header">
                    <div class="upload-section-icon" style="color: var(--coral-pink);">📋</div>
                    <div class="upload-section-info">
                        <h3>Recent Activity</h3>
                        <p>Your latest homework submissions and teacher feedback</p>
                    </div>
                </div>
                
                <div id="recentActivity" class="content-preview-grid">
                    <!-- Recent activity will be loaded here -->
                </div>
            </div>
            
            <!-- Parent Access Section (Year 5 only) -->
            ${selectedClub === 'year5' ? `
                <div class="enhanced-upload-section">
                    <div class="upload-section-header">
                        <div class="upload-section-icon" style="color: var(--primary-purple);">👨‍👩‍👧‍👦</div>
                        <div class="upload-section-info">
                            <h3>Parent Dashboard Access</h3>
                            <p>Parents can view your progress with secure access</p>
                        </div>
                    </div>
                    
                    <div class="parent-access-card">
                        <div class="access-info">
                            <h4>🔐 Parent Access Code</h4>
                            <p>Share this secure code with your parents so they can view your progress:</p>
                            <div class="access-code" id="parentAccessCode">Loading...</div>
                        </div>
                        <div class="privacy-info">
                            <h4>🛡️ Your Privacy Rights</h4>
                            <p>You can control what information your parents can see. <a href="#" onclick="openPrivacySettings()">Manage privacy settings</a></p>
                        </div>
                    </div>
                </div>
            ` : ''}
        </div>
    `;
}

        function renderSubscription() {
            return `
                <div class="content-area">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Subscription Information</h1>
                            <p class="content-subtitle">Manage your learning platform access</p>
                        </div>
                    </div>
                    
                    <div class="coming-soon">
                        <div class="coming-soon-icon">💳</div>
                        <h3>Subscription Management Coming Soon!</h3>
                        <p>
                            View your current subscription plan, update payment methods, 
                            and manage your billing preferences. Different pricing for 
                            Year 4 and Year 5 programs.
                        </p>
                    </div>
                    
                    <div class="content-grid">
                        <div class="content-card year4" style="border-left: 5px solid var(--bright-orange);">
                            <span class="card-icon" style="color: var(--bright-orange);">🎓</span>
                            <h3 class="card-title">Year 4 - 11+ Prep Club</h3>
                            <p class="card-description">£5.95/month or £60/year</p>
                            <div class="card-meta"><span>Foundation Level</span></div>
                        </div>
                        
                        <div class="content-card year5" style="border-left: 5px solid var(--grass-green);">
                            <span class="card-icon" style="color: var(--grass-green);">🚀</span>
                            <h3 class="card-title">Year 5 - 11+ Club</h3>
                            <p class="card-description">£7.95/month or £84/year</p>
                            <div class="card-meta"><span>Intensive Level</span></div>
                        </div>
                        
                        <div class="content-card" style="border-left: 5px solid var(--primary-purple);">
                            <span class="card-icon" style="color: var(--primary-purple);">⭐</span>
                            <h3 class="card-title">Full Subscription</h3>
                            <p class="card-description">£9.95/month or £108/year</p>
                            <div class="card-meta"><span>Both Programs</span></div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAdminLessons() {
            console.log('Rendering admin lessons page');
            
            if (!userIsAdmin) {
                return `
                    <div class="content-area">
                        <div class="coming-soon">
                            <div class="coming-soon-icon">🚫</div>
                            <h3>Access Denied</h3>
                            <p>You don't have permission to access this area.</p>
                        </div>
                    </div>
                `;
            }

            // Ensure modal is hidden when admin page loads
            setTimeout(() => {
                const modal = document.getElementById('bulkUploadModal');
                if (modal) {
                    modal.classList.add('hidden');
                    modal.style.display = 'none';
                    console.log('Admin page loaded - modal hidden');
                }
            }, 50);

            return `
                <div class="content-area">
                    <div class="content-header">
                        <div>
                            <h1 class="content-title">Bulk Upload Tools</h1>
                            <p class="content-subtitle">Admin tools for lesson management</p>
                        </div>
                    </div>
                    
                    <div class="content-grid">
                        <div class="content-card planning">
                            <span class="card-icon">📅</span>
                            <h3 class="card-title">Year Plan Upload</h3>
                            <p class="card-description">
                                Upload Excel spreadsheet with the structured year-ahead plan 
                                including weekly topics and objectives.
                            </p>
                            <div class="card-meta">
                                <span>📊 Excel Format</span>
                                <span>🗓️ 44 Weeks</span>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="showBulkUploadForm('year-plan')">
                                    📤 Upload Year Plan
                                </button>
                            </div>
                        </div>
                        
                        <div class="content-card maths">
                            <span class="card-icon">📚</span>
                            <h3 class="card-title">Lesson Materials</h3>
                            <p class="card-description">
                                Bulk upload lesson plans, worksheets, and teaching materials. 
                                Supports multiple file types and automatic organization.
                            </p>
                            <div class="card-meta">
                                <span>📁 Multiple Files</span>
                                <span>🏷️ Auto-Tagged</span>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="showBulkUploadForm('bulk-lessons')">
                                    📤 Upload Lessons
                                </button>
                            </div>
                        </div>
                        
                        <div class="content-card resources">
                            <span class="card-icon">🎯</span>
                            <h3 class="card-title">Extra Resources</h3>
                            <p class="card-description">
                                Upload videos, past papers, reading lists and supplementary 
                                materials for enhanced learning experiences.
                            </p>
                            <div class="card-meta">
                                <span>🎥 Media Files</span>
                                <span>📄 Documents</span>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="showBulkUploadForm('resources')">
                                    📤 Upload Resources
                                </button>
                            </div>
                        </div>
                        
                        <div class="content-card" style="border-left: 5px solid var(--primary-purple);">
                            <span class="card-icon" style="color: var(--primary-purple);">📊</span>
                            <h3 class="card-title">Upload Status</h3>
                            <p class="card-description">
                                Track upload progress and view recently uploaded content.
                                Monitor processing status and errors.
                            </p>
                            <div class="card-meta">
                                <span>⚡ Real-time</span>
                                <span>📈 Analytics</span>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-secondary" onclick="viewUploadStatus()">
                                    📈 View Status
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Bulk Upload Modal -->
                    <div id="bulkUploadModal" class="modal hidden" onclick="handleModalBackdropClick(event)">
                        <div class="modal-content" onclick="event.stopPropagation()">
                            <div class="modal-header">
                                <h3 id="modalTitle">Bulk Upload</h3>
                                <span class="modal-close" onclick="hideBulkUploadForm()">&times;</span>
                            </div>
                            <div class="modal-body">
                                <form id="bulkUploadForm" onsubmit="handleBulkUpload(event)">
                                    <input type="hidden" id="uploadContentType" name="contentType">
                                    
                                    <div class="form-group">
                                        <label for="yearGroup">Year Group</label>
                                        <select id="yearGroup" name="yearGroup" required class="form-select">
                                            <option value="year4">Year 4 - 11+ Prep Club</option>
                                            <option value="year5">Year 5 - 11+ Club</option>
                                        </select>
                                    </div>
                                    
                                    <div id="uploadFields"></div>
                                    
                                    <div class="form-actions">
                                        <button type="button" class="btn btn-secondary" onclick="hideBulkUploadForm()">Cancel</button>
                                        <button type="submit" class="btn" id="uploadBtn">
                                            <span id="uploadBtnText">Upload</span>
                                            <span id="uploadLoader" class="loading hidden"></span>
                                        </button>
                                    </div>
                                </form>
                                
                                <div id="uploadProgress" class="upload-progress hidden">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 0%"></div>
                                    </div>
                                    <p id="progressText">Uploading...</p>
                                </div>
                                
                                <div id="uploadResults" class="upload-results hidden"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============================================
        // MOBILE OPTIMIZATION FUNCTIONALITY
        // ============================================

        // Mobile viewport and touch handling
        let isMobile = window.innerWidth <= 768;
        let isTablet = window.innerWidth > 768 && window.innerWidth <= 1024;

        // Update mobile state on resize
        window.addEventListener('resize', () => {
            isMobile = window.innerWidth <= 768;
            isTablet = window.innerWidth > 768 && window.innerWidth <= 1024;
            handleResponsiveChanges();
        });

        // Handle responsive layout changes
        function handleResponsiveChanges() {
            if (isMobile) {
                // Mobile-specific adjustments
                document.body.classList.add('mobile-view');
                document.body.classList.remove('tablet-view', 'desktop-view');
                
                // Optimize modals for mobile
                optimizeModalsForMobile();
                
                // Enable touch gestures
                enableTouchGestures();
            } else if (isTablet) {
                document.body.classList.add('tablet-view');
                document.body.classList.remove('mobile-view', 'desktop-view');
            } else {
                document.body.classList.add('desktop-view');
                document.body.classList.remove('mobile-view', 'tablet-view');
            }
        }

        // Optimize modals for mobile devices
        function optimizeModalsForMobile() {
            if (!isMobile) return;

            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                // Add mobile scroll handling
                modal.addEventListener('touchmove', (e) => {
                    const modalContent = modal.querySelector('.modal-content');
                    if (modalContent && modalContent.contains(e.target)) {
                        e.stopPropagation();
                    }
                });

                // Prevent background scroll when modal is open
                modal.addEventListener('scroll', (e) => {
                    if (e.target === modal) {
                        e.preventDefault();
                    }
                });
            });
        }

        // Enable touch gestures for mobile
        function enableTouchGestures() {
            if (!isMobile) return;

            // Add swipe-to-close for modals
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                let startY = 0;
                let startX = 0;

                modal.addEventListener('touchstart', (e) => {
                    startY = e.touches[0].clientY;
                    startX = e.touches[0].clientX;
                });

                modal.addEventListener('touchend', (e) => {
                    if (!e.changedTouches[0]) return;
                    
                    const endY = e.changedTouches[0].clientY;
                    const endX = e.changedTouches[0].clientX;
                    const deltaY = endY - startY;
                    const deltaX = endX - startX;

                    // Swipe down to close modal
                    if (deltaY > 100 && Math.abs(deltaX) < 50) {
                        const closeEvent = new Event('click');
                        const closeButton = modal.querySelector('.close-button');
                        if (closeButton && !modal.classList.contains('hidden')) {
                            closeButton.dispatchEvent(closeEvent);
                        }
                    }
                });
            });

            // Add pull-to-refresh hint (visual only)
            addPullToRefreshHint();
        }

        // Add pull-to-refresh visual hint
        function addPullToRefreshHint() {
            let startY = 0;
            let pullDistance = 0;
            const threshold = 80;

            document.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
            });

            document.addEventListener('touchmove', (e) => {
                if (window.scrollY === 0) {
                    pullDistance = e.touches[0].clientY - startY;
                    
                    if (pullDistance > 20 && pullDistance < threshold) {
                        document.body.style.paddingTop = `${pullDistance * 0.3}px`;
                        document.body.style.background = `linear-gradient(to bottom, #f0f9ff ${pullDistance}px, var(--background-light) ${pullDistance + 10}px)`;
                    }
                }
            });

            document.addEventListener('touchend', () => {
                document.body.style.paddingTop = '0';
                document.body.style.background = '';
                pullDistance = 0;
            });
        }

        // Mobile-friendly notification system
        function showMobileToast(message, type = 'info', duration = 3000) {
            if (!isMobile && document.querySelectorAll('.toast').length === 0) {
                // Use regular alerts on desktop if no toast system
                alert(message);
                return;
            }

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#3b82f6'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 10000;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                opacity: 0;
                animation: slideInToast 0.3s ease forwards;
            `;
            
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOutToast 0.3s ease forwards';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, duration);
        }

        // Add toast animations to CSS
        const toastStyles = document.createElement('style');
        toastStyles.textContent = `
            @keyframes slideInToast {
                from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                to { opacity: 1; transform: translateX(-50%) translateY(0); }
            }
            @keyframes slideOutToast {
                from { opacity: 1; transform: translateX(-50%) translateY(0); }
                to { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            }
        `;
        document.head.appendChild(toastStyles);

        // Mobile-optimized drag and drop for file uploads
        function initializeMobileDragDrop() {
            if (!isMobile) return;

            const dropAreas = document.querySelectorAll('.file-upload-area');
            dropAreas.forEach(area => {
                // Convert drag events to touch events
                area.addEventListener('touchstart', (e) => {
                    area.classList.add('drag-over');
                });

                area.addEventListener('touchend', (e) => {
                    area.classList.remove('drag-over');
                    
                    // Trigger file input on touch
                    const input = area.parentElement.querySelector('input[type="file"]');
                    if (input) {
                        input.click();
                    }
                });
            });
        }

        // Initialize mobile optimizations when page loads
        document.addEventListener('DOMContentLoaded', () => {
            handleResponsiveChanges();
            initializeMobileDragDrop();
            
            // Add mobile-specific body classes
            if (isMobile) {
                document.body.classList.add('mobile-device');
            } else if (isTablet) {
                document.body.classList.add('tablet-device');
            }
        });

        // Mobile-friendly error handling
        function handleMobileError(error, context = '') {
            console.error(`Mobile Error (${context}):`, error);
            
            if (isMobile) {
                showMobileToast(`Something went wrong. Please try again.`, 'error');
            } else {
                alert(`Error: ${error.message || 'Something went wrong'}`);
            }
        }

        // ============================================
        // ENHANCED CONTENT FUNCTIONALITY
        // ============================================

        // Load content previews for different sections
        async function loadWeeklyContent(contentType) {
            console.log('Loading weekly content:', contentType);
            try {
                await loadContentPreviews('contentPreviewArea', {
                    type: contentType,
                    yearGroup: selectedClub,
                    subject: 'general'
                });
            } catch (error) {
                console.error('Error loading weekly content:', error);
            }
        }

        async function loadMathsTopic(topic) {
            console.log('Loading maths topic:', topic);
            try {
                await loadContentPreviews('mathsContentPreview', {
                    type: 'lesson-material',
                    subject: 'maths',
                    category: topic,
                    yearGroup: selectedClub
                });
            } catch (error) {
                console.error('Error loading maths topic:', error);
            }
        }

        async function loadEnglishTopic(topic) {
            console.log('Loading english topic:', topic);
            try {
                await loadContentPreviews('englishContentPreview', {
                    type: 'lesson-material',
                    subject: 'english',
                    category: topic,
                    yearGroup: selectedClub
                });
            } catch (error) {
                console.error('Error loading english topic:', error);
            }
        }

        // Enhanced content preview loader with skeleton and transitions
        async function loadContentPreviews(containerId, filters) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // Show skeleton loader
            const skeleton = showSkeletonLoader(container, 3);

            try {
                const queryParams = new URLSearchParams(filters);
                const response = await fetch(`http://localhost:7071/api/get-content?${queryParams}`);
                const data = await response.json();

                // Simulate minimum loading time for smooth UX
                await new Promise(resolve => setTimeout(resolve, 500));

                // Remove skeleton loader
                removeSkeletonLoader(container);

                if (data.success && data.content) {
                    renderContentPreviews(container, data.content.all || []);
                } else {
                    container.innerHTML = '<div class="no-content animate-in">No content available yet.</div>';
                }
            } catch (error) {
                console.error('Error loading content previews:', error);
                removeSkeletonLoader(container);
                container.innerHTML = '<div class="error-message animate-in">Failed to load content. Please try again.</div>';
                showFeedback('Failed to load content', 'error', 3000);
            }
        }

        // Render content preview cards
        function renderContentPreviews(container, contentItems) {
            if (!contentItems.length) {
                container.innerHTML = '<div class="no-content">No content available yet.</div>';
                return;
            }

            const previewCards = contentItems.slice(0, 6).map((item, index) => `
                <div class="content-preview-card animate-in" style="animation-delay: ${index * 0.1}s">
                    <div class="preview-header">
                        <div class="preview-icon">${getContentIcon(item.type, item.subject)}</div>
                        <div>
                            <h4 class="preview-title">${item.title || 'Untitled'}</h4>
                            <p class="preview-subtitle">${formatContentType(item.type)} • ${formatSubject(item.subject)}</p>
                        </div>
                    </div>
                    <div class="preview-content">
                        <p class="preview-description">${item.description || 'No description available'}</p>
                        <div class="preview-metadata">
                            ${item.yearGroup ? `<span class="metadata-tag">${item.yearGroup.toUpperCase()}</span>` : ''}
                            ${item.category ? `<span class="metadata-tag">${item.category}</span>` : ''}
                            ${item.fileType ? `<span class="metadata-tag">${item.fileType.toUpperCase()}</span>` : ''}
                        </div>
                    </div>
                    <div class="preview-actions">
                        <button class="btn btn-xs" onclick="viewContent('${item.id}')">👁️ View</button>
                        <button class="btn btn-xs btn-secondary" onclick="downloadContent('${item.id}')">⬇️ Download</button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = previewCards;
        }

        // Helper functions for content display
        function getContentIcon(type, subject) {
            const icons = {
                'year-plan': '📅',
                'lesson-material': subject === 'maths' ? '🔢' : subject === 'english' ? '📚' : '📖',
                'extra-resource': '🎯'
            };
            return icons[type] || '📄';
        }

        function formatContentType(type) {
            const types = {
                'year-plan': 'Year Plan',
                'lesson-material': 'Lesson Material',
                'extra-resource': 'Extra Resource'
            };
            return types[type] || type;
        }

        function formatSubject(subject) {
            const subjects = {
                'maths': 'Mathematics',
                'english': 'English',
                'general': 'General'
            };
            return subjects[subject] || subject;
        }

        // Content interaction functions
        async function viewContent(contentId) {
            console.log('Viewing content:', contentId);
            // This would open a modal or navigate to content view
            alert('Content viewer coming soon!');
        }

        async function downloadContent(contentId) {
            console.log('Downloading content:', contentId);
            try {
                const response = await fetch('http://localhost:7071/api/download', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contentId })
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `content-${contentId}`;
                    a.click();
                    window.URL.revokeObjectURL(url);
                } else {
                    throw new Error('Download failed');
                }
            } catch (error) {
                console.error('Download error:', error);
                alert('Download failed. Please try again.');
            }
        }

        // ============================================
        // STUDENT PORTAL & GDPR FUNCTIONALITY
        // ============================================

        // GDPR Consent Management
        let gdprConsent = {
            dataProcessing: false,
            progressTracking: false,
            parentAccess: false
        };

        // Load student progress data
        async function loadStudentProgress() {
            try {
                const response = await fetch('http://localhost:7071/api/student-progress', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'get-progress',
                        userEmail: userEmail,
                        isStudent: true
                    })
                });

                const data = await response.json();
                if (data.success) {
                    updateProgressOverview(data.metrics);
                    return data.progress;
                } else {
                    console.error('Failed to load progress:', data.error);
                    return [];
                }
            } catch (error) {
                console.error('Error loading student progress:', error);
                return [];
            }
        }

        // Update progress overview statistics
        function updateProgressOverview(metrics) {
            if (!metrics) return;

            const totalEl = document.getElementById('totalAssignments');
            const completedEl = document.getElementById('completedAssignments');
            const averageEl = document.getElementById('averageScore');
            const trendEl = document.getElementById('improvementTrend');

            if (totalEl) totalEl.textContent = metrics.totalAssignments || 0;
            if (completedEl) completedEl.textContent = metrics.completedAssignments || 0;
            if (averageEl) averageEl.textContent = metrics.averageScore ? `${metrics.averageScore}%` : '-';
            
            if (trendEl) {
                const trendEmojis = {
                    'improving': '📈',
                    'declining': '📉',
                    'neutral': '📊'
                };
                trendEl.textContent = trendEmojis[metrics.improvementTrend] || '📊';
            }
        }

        // Load student homework
        async function loadStudentHomework() {
            console.log('Loading student homework...');
            try {
                const response = await fetch('http://localhost:7071/api/student-progress', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'get-homework',
                        userEmail: userEmail,
                        isStudent: true
                    })
                });

                const data = await response.json();
                if (data.success) {
                    displayHomeworkList(data.homework);
                } else {
                    console.error('Failed to load homework:', data.error);
                }
            } catch (error) {
                console.error('Error loading homework:', error);
            }
        }

        // Display homework list
        function displayHomeworkList(homework) {
            const submissionArea = document.getElementById('homeworkSubmission');
            if (!homework.length) {
                submissionArea.innerHTML = `
                    <div class="no-content">
                        <h4>No homework assignments yet</h4>
                        <p>Your teacher will assign homework soon!</p>
                    </div>
                `;
                return;
            }

            const homeworkCards = homework.map(hw => `
                <div class="content-preview-card">
                    <div class="preview-header">
                        <div class="preview-icon">📝</div>
                        <div>
                            <h4 class="preview-title">${hw.title || 'Assignment'}</h4>
                            <p class="preview-subtitle">Due: ${new Date(hw.dueDate).toLocaleDateString()}</p>
                        </div>
                    </div>
                    <div class="preview-content">
                        <p class="preview-description">${hw.description || 'No description'}</p>
                        <div class="preview-metadata">
                            <span class="metadata-tag">${hw.subject || 'General'}</span>
                            <span class="metadata-tag">${hw.status || 'Pending'}</span>
                        </div>
                    </div>
                    <div class="preview-actions">
                        <button class="btn btn-xs" onclick="submitHomework('${hw.id}')">📤 Submit</button>
                        <button class="btn btn-xs btn-secondary" onclick="viewHomework('${hw.id}')">👁️ View</button>
                    </div>
                </div>
            `).join('');

            submissionArea.innerHTML = homeworkCards;
        }

        // Load progress reports
        async function loadProgressReports() {
            console.log('Loading progress reports...');
            const progress = await loadStudentProgress();
            displayProgressReports(progress);
        }

        // Display progress reports
        function displayProgressReports(progress) {
            const activityArea = document.getElementById('recentActivity');
            if (!progress.length) {
                activityArea.innerHTML = `
                    <div class="no-content">
                        <h4>No progress reports yet</h4>
                        <p>Your teacher will add progress updates soon!</p>
                    </div>
                `;
                return;
            }

            const reportCards = progress.slice(0, 6).map(report => `
                <div class="content-preview-card">
                    <div class="preview-header">
                        <div class="preview-icon">📊</div>
                        <div>
                            <h4 class="preview-title">${report.title || 'Progress Update'}</h4>
                            <p class="preview-subtitle">${new Date(report.createdDate).toLocaleDateString()}</p>
                        </div>
                    </div>
                    <div class="preview-content">
                        <p class="preview-description">${report.feedback || 'No feedback yet'}</p>
                        <div class="preview-metadata">
                            ${report.score ? `<span class="metadata-tag">Score: ${report.score}%</span>` : ''}
                            <span class="metadata-tag">${report.subject || 'General'}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            activityArea.innerHTML = reportCards;
        }

        // Load achievements
        async function loadAchievements() {
            console.log('Loading achievements...');
            // Mock achievements for now
            const achievements = [
                { title: 'First Homework', description: 'Completed your first assignment!', icon: '🏆' },
                { title: 'Math Master', description: 'Scored 90%+ on 5 math assignments', icon: '🔢' },
                { title: 'Writing Wizard', description: 'Excellent creative writing skills', icon: '✍️' }
            ];
            displayAchievements(achievements);
        }

        // Display achievements
        function displayAchievements(achievements) {
            const activityArea = document.getElementById('recentActivity');
            const achievementCards = achievements.map(achievement => `
                <div class="content-preview-card" style="border-left-color: var(--bright-orange);">
                    <div class="preview-header">
                        <div class="preview-icon">${achievement.icon}</div>
                        <div>
                            <h4 class="preview-title">${achievement.title}</h4>
                            <p class="preview-subtitle">Achievement Unlocked!</p>
                        </div>
                    </div>
                    <div class="preview-content">
                        <p class="preview-description">${achievement.description}</p>
                    </div>
                </div>
            `).join('');

            activityArea.innerHTML = achievementCards;
        }

        // GDPR Consent Functions
        function acceptGDPRConsent() {
            gdprConsent.dataProcessing = true;
            gdprConsent.progressTracking = true;
            
            const consentBanner = document.getElementById('gdprConsentBanner');
            if (consentBanner) {
                consentBanner.classList.add('hidden');
            }
            
            // Save consent to database
            saveGDPRConsent();
            
            // Load student data
            loadStudentProgress();
            generateParentAccessCode();
        }

        function declineGDPRConsent() {
            gdprConsent.dataProcessing = false;
            gdprConsent.progressTracking = false;
            
            const consentBanner = document.getElementById('gdprConsentBanner');
            if (consentBanner) {
                consentBanner.classList.add('hidden');
            }
            
            // Show limited functionality message
            const progressOverview = document.getElementById('progressOverview');
            if (progressOverview) {
                progressOverview.innerHTML = `
                    <div class="no-content">
                        <h4>🔒 Privacy Mode Active</h4>
                        <p>Progress tracking is disabled. You can still access learning materials.</p>
                    </div>
                `;
            }
        }

        // Save GDPR consent
        async function saveGDPRConsent() {
            try {
                await fetch('http://localhost:7071/api/checkuserstatus', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: userEmail,
                        gdprConsent: gdprConsent
                    })
                });
            } catch (error) {
                console.error('Error saving GDPR consent:', error);
            }
        }

        // Generate parent access code
        function generateParentAccessCode() {
            const parentAccessCodeEl = document.getElementById('parentAccessCode');
            if (parentAccessCodeEl) {
                const accessCode = Math.random().toString(36).substring(2, 10).toUpperCase();
                parentAccessCodeEl.textContent = accessCode;
            }
        }

        // Homework submission functions
        async function submitHomework(homeworkId) {
            console.log('Submitting homework:', homeworkId);
            alert('Homework submission feature coming soon!');
        }

        function viewHomework(homeworkId) {
            console.log('Viewing homework:', homeworkId);
            alert('Homework viewer coming soon!');
        }

        // Privacy settings
        function openPrivacySettings() {
            alert('Privacy settings panel coming soon!');
        }

        // Initialize student portal when page loads
        function initializeStudentPortal() {
            try {
                // Check GDPR consent status
                const consentBanner = document.getElementById('gdprConsentBanner');
                if (!gdprConsent.dataProcessing && consentBanner) {
                    consentBanner.classList.remove('hidden');
                } else {
                    loadStudentProgress();
                    generateParentAccessCode();
                }
            } catch (error) {
                console.error('Error initializing student portal:', error);
            }
        }

        // ============================================
        // BULK UPLOAD FUNCTIONALITY
        // ============================================

        let selectedFiles = [];
        let currentUploadType = '';

        function showBulkUploadForm(uploadType) {
            console.log('Opening bulk upload modal for:', uploadType);
            currentUploadType = uploadType;
            selectedFiles = [];
            
            const modal = document.getElementById('bulkUploadModal');
            const modalTitle = document.getElementById('modalTitle');
            const uploadFields = document.getElementById('uploadFields');
            const uploadContentType = document.getElementById('uploadContentType');
            
            if (!modal) {
                console.error('Bulk upload modal not found!');
                return;
            }
            
            uploadContentType.value = uploadType;
            
            // Set modal title and fields based on upload type
            switch (uploadType) {
                case 'year-plan':
                    modalTitle.textContent = 'Upload Year Plan';
                    uploadFields.innerHTML = `
                        <div class="form-group">
                            <label>Excel Spreadsheet</label>
                            <div class="file-upload-area" onclick="triggerFileSelect('planFile')" 
                                 ondrop="handleFileDrop(event, 'single')" 
                                 ondragover="handleDragOver(event)" 
                                 ondragleave="handleDragLeave(event)">
                                <div class="file-upload-icon">📊</div>
                                <div class="file-upload-text">Click to select or drag Excel file here</div>
                                <div class="file-upload-hint">Accepts .xlsx files with weekly lesson plan structure</div>
                            </div>
                            <input type="file" id="planFile" accept=".xlsx,.xls" style="display: none;" 
                                   onchange="handleFileSelect(event, 'single')">
                            <div id="planFileList" class="file-list"></div>
                        </div>
                    `;
                    break;
                
                case 'bulk-lessons':
                    modalTitle.textContent = 'Upload Lesson Materials';
                    uploadFields.innerHTML = `
                        <div class="form-group">
                            <label>Lesson Files</label>
                            <div class="file-upload-area" onclick="triggerFileSelect('lessonFiles')"
                                 ondrop="handleFileDrop(event, 'multiple')" 
                                 ondragover="handleDragOver(event)" 
                                 ondragleave="handleDragLeave(event)">
                                <div class="file-upload-icon">📚</div>
                                <div class="file-upload-text">Click to select or drag lesson files here</div>
                                <div class="file-upload-hint">Accepts PDF, DOCX, PPT and image files</div>
                            </div>
                            <input type="file" id="lessonFiles" accept=".pdf,.docx,.pptx,.jpg,.jpeg,.png" 
                                   multiple style="display: none;" onchange="handleFileSelect(event, 'multiple')">
                            <div id="lessonFilesList" class="file-list"></div>
                        </div>
                    `;
                    break;
                
                case 'resources':
                    modalTitle.textContent = 'Upload Extra Resources';
                    uploadFields.innerHTML = `
                        <div class="form-group">
                            <label>Resource Files</label>
                            <div class="file-upload-area" onclick="triggerFileSelect('resourceFiles')"
                                 ondrop="handleFileDrop(event, 'multiple')" 
                                 ondragover="handleDragOver(event)" 
                                 ondragleave="handleDragLeave(event)">
                                <div class="file-upload-icon">🎯</div>
                                <div class="file-upload-text">Click to select or drag resource files here</div>
                                <div class="file-upload-hint">Videos, PDFs, images and other educational materials</div>
                            </div>
                            <input type="file" id="resourceFiles" multiple style="display: none;"
                                   onchange="handleFileSelect(event, 'multiple')">
                            <div id="resourceFilesList" class="file-list"></div>
                        </div>
                    `;
                    break;
            }
            
            // Set default year group based on current selection
            const yearGroupSelect = document.getElementById('yearGroup');
            if (selectedClub) {
                yearGroupSelect.value = selectedClub;
            }
            
            showModalWithAnimation(modal);
            document.body.style.overflow = 'hidden';
        }

        function hideBulkUploadForm() {
            console.log('Closing bulk upload modal...');
            
            const modal = document.getElementById('bulkUploadModal');
            if (!modal) {
                console.log('Modal not found');
                return;
            }
            
            // Hide modal with animation
            hideModalWithAnimation(modal, () => {
                document.body.style.overflow = 'auto';
            });
            
            // Reset global variables
            selectedFiles = [];
            currentUploadType = '';
            
            // Reset form elements safely
            const elements = {
                uploadProgress: document.getElementById('uploadProgress'),
                uploadResults: document.getElementById('uploadResults'), 
                uploadBtnText: document.getElementById('uploadBtnText'),
                uploadLoader: document.getElementById('uploadLoader'),
                uploadBtn: document.getElementById('uploadBtn')
            };
            
            Object.entries(elements).forEach(([key, element]) => {
                if (element) {
                    switch (key) {
                        case 'uploadProgress':
                        case 'uploadResults':
                        case 'uploadLoader':
                            element.classList.add('hidden');
                            break;
                        case 'uploadBtnText':
                            element.textContent = 'Upload';
                            break;
                        case 'uploadBtn':
                            element.disabled = false;
                            break;
                    }
                }
            });
            
            // Clear file inputs and lists
            try {
                const fileInputs = document.querySelectorAll('input[type="file"]');
                fileInputs.forEach(input => {
                    if (input) input.value = '';
                });
                
                const fileLists = document.querySelectorAll('.file-list');
                fileLists.forEach(list => {
                    if (list) list.innerHTML = '';
                });
            } catch (error) {
                console.log('Error clearing file inputs:', error);
            }
            
            console.log('Modal closed successfully');
        }

        // Emergency close function for stuck modals
        function forceCloseModal() {
            console.log('Force closing modal...');
            const modal = document.getElementById('bulkUploadModal');
            if (modal) {
                modal.style.display = 'none';
                modal.classList.add('hidden');
            }
            document.body.style.overflow = 'auto';
            selectedFiles = [];
            currentUploadType = '';
            
            // Remove any stuck force close buttons
            const forceBtn = document.querySelector('.force-close-btn');
            if (forceBtn) {
                forceBtn.remove();
            }
        }

        // Upload status function
        function viewUploadStatus() {
            showStatus('Upload Status feature coming soon! This will show recent uploads, processing status, and any errors.', 'info');
        }

        function triggerFileSelect(inputId) {
            document.getElementById(inputId).click();
        }

        function handleFileSelect(event, mode) {
            const files = Array.from(event.target.files);
            
            if (mode === 'single') {
                selectedFiles = files.slice(0, 1);
            } else {
                selectedFiles = [...selectedFiles, ...files];
            }
            
            updateFileList();
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(event) {
            // Only remove drag-over if leaving the drop zone entirely
            if (!event.currentTarget.contains(event.relatedTarget)) {
                event.currentTarget.classList.remove('drag-over');
            }
        }

        function handleFileDrop(event, mode) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            const files = Array.from(event.dataTransfer.files);
            
            if (mode === 'single') {
                selectedFiles = files.slice(0, 1);
            } else {
                selectedFiles = [...selectedFiles, ...files];
            }
            
            updateFileList();
        }

        function updateFileList() {
            let listContainer;
            
            switch (currentUploadType) {
                case 'year-plan':
                    listContainer = document.getElementById('planFileList');
                    break;
                case 'bulk-lessons':
                    listContainer = document.getElementById('lessonFilesList');
                    break;
                case 'resources':
                    listContainer = document.getElementById('resourceFilesList');
                    break;
            }
            
            if (!listContainer) return;
            
            if (selectedFiles.length === 0) {
                listContainer.innerHTML = '';
                return;
            }
            
            const fileListHTML = selectedFiles.map((file, index) => `
                <div class="file-item">
                    <div class="file-info">
                        <span class="file-icon">${getFileIcon(file.type)}</span>
                        <span>${file.name}</span>
                        <span style="color: var(--text-light); font-size: 12px;">(${formatFileSize(file.size)})</span>
                    </div>
                    <span class="file-remove" onclick="removeFile(${index})">&times;</span>
                </div>
            `).join('');
            
            listContainer.innerHTML = fileListHTML;
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
        }

        function getFileIcon(fileType) {
            if (fileType.includes('excel') || fileType.includes('spreadsheet')) return '📊';
            if (fileType.includes('pdf')) return '📄';
            if (fileType.includes('word') || fileType.includes('document')) return '📝';
            if (fileType.includes('powerpoint') || fileType.includes('presentation')) return '📽️';
            if (fileType.includes('image')) return '🖼️';
            if (fileType.includes('video')) return '🎥';
            return '📁';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function handleBulkUpload(event) {
            event.preventDefault();
            
            if (selectedFiles.length === 0) {
                alert('Please select files to upload');
                return;
            }
            
            const uploadBtn = document.getElementById('uploadBtn');
            const uploadBtnText = document.getElementById('uploadBtnText');
            const uploadLoader = document.getElementById('uploadLoader');
            const uploadProgress = document.getElementById('uploadProgress');
            const uploadResults = document.getElementById('uploadResults');
            
            const formData = new FormData();
            const yearGroup = document.getElementById('yearGroup').value;
            const userEmail = currentAccount?.username || currentAccount?.idTokenClaims?.emails?.[0];
            
            // Set enhanced loading state
            setButtonLoading(uploadBtn, true, 'Upload');
            uploadProgress.classList.remove('hidden');
            uploadResults.classList.add('hidden');
            
            // Add visual feedback for files being uploaded
            selectedFiles.forEach((file, index) => {
                const fileElements = document.querySelectorAll('.file-item');
                if (fileElements[index]) {
                    animateFileUpload(fileElements[index], 'uploading');
                }
            });
            
            // Add form fields
            formData.append('isAdmin', userIsAdmin.toString());
            formData.append('userEmail', userEmail);
            formData.append('contentType', currentUploadType);
            formData.append('yearGroup', yearGroup);
            
            // Add files with appropriate field names
            switch (currentUploadType) {
                case 'year-plan':
                    if (selectedFiles[0]) {
                        formData.append('planFile', selectedFiles[0]);
                    }
                    break;
                    
                case 'bulk-lessons':
                    selectedFiles.forEach((file, index) => {
                        formData.append(`lesson-${index}`, file);
                    });
                    break;
                    
                case 'resources':
                    selectedFiles.forEach((file, index) => {
                        formData.append(`resource-${index}`, file);
                    });
                    break;
            }
            
            try {
                // Update progress
                updateProgress(25, 'Preparing files...');
                
                const response = await fetch('/api/bulk-upload', {
                    method: 'POST',
                    body: formData
                });
                
                updateProgress(75, 'Processing files...');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                updateProgress(100, 'Upload complete!');
                
                setTimeout(() => {
                    displayUploadResults(result);
                }, 500);
                
            } catch (error) {
                console.error('Upload error:', error);
                displayUploadResults({
                    success: false,
                    error: 'Upload failed: ' + error.message
                });
            } finally {
                // Reset enhanced button state
                setButtonLoading(uploadBtn, false);
                
                // Update file animations based on result
                setTimeout(() => {
                    selectedFiles.forEach((file, index) => {
                        const fileElements = document.querySelectorAll('.file-item');
                        if (fileElements[index]) {
                            animateFileUpload(fileElements[index], 'success');
                        }
                    });
                }, 100);
            }
        }

        function updateProgress(percentage, text) {
            document.querySelector('.progress-fill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = text;
        }

        function displayUploadResults(result) {
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('uploadBtnText').textContent = 'Upload';
            document.getElementById('uploadLoader').classList.add('hidden');
            
            const resultsContainer = document.getElementById('uploadResults');
            resultsContainer.classList.remove('hidden', 'success', 'error');
            
            if (result.success) {
                resultsContainer.classList.add('success');
                resultsContainer.innerHTML = `
                    <h4>✅ Upload Successful!</h4>
                    <p>${result.message}</p>
                    ${result.lessonsCreated ? `<p><strong>Lessons Created:</strong> ${result.lessonsCreated}</p>` : ''}
                    
                    ${result.results ? `
                        <div class="results-list">
                            ${result.results.map(item => `
                                <div class="result-item">
                                    <span class="result-status">${item.success ? '✅' : '❌'}</span>
                                    <span>${item.fileName || item.type}</span>
                                    ${item.error ? `<span style="color: var(--coral-pink);">${item.error}</span>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                `;
                
                // Show success feedback and auto-close
                showFeedback('Files uploaded successfully!', 'success', 4000);
                setTimeout(() => {
                    hideBulkUploadForm();
                }, 3000);
                
            } else {
                resultsContainer.classList.add('error');
                resultsContainer.innerHTML = `
                    <h4>❌ Upload Failed</h4>
                    <p>${result.error}</p>
                    ${result.details ? `<p><small>${result.details}</small></p>` : ''}
                `;
                // Show error feedback
                showFeedback('Upload failed: ' + result.error, 'error', 5000);
            }
        }

        // Add keyboard and modal event listeners
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                const modal = document.getElementById('bulkUploadModal');
                if (modal && !modal.classList.contains('hidden')) {
                    hideBulkUploadForm();
                }
            }
        });

        // Handle modal backdrop clicks
        function handleModalBackdropClick(event) {
            if (event.target === event.currentTarget) {
                hideBulkUploadForm();
            }
        }

        // Close modal when clicking outside (backup)
        document.addEventListener('click', (event) => {
            const modal = document.getElementById('bulkUploadModal');
            if (modal && !modal.classList.contains('hidden')) {
                if (event.target === modal) {
                    hideBulkUploadForm();
                }
            }
        });

        // Expose global emergency function for console access
        window.emergencyCloseModal = function() {
            console.log('EMERGENCY: Closing modal from console');
            const modal = document.getElementById('bulkUploadModal');
            if (modal) {
                modal.style.display = 'none !important';
                modal.classList.add('hidden');
                modal.remove(); // Nuclear option - remove it entirely
            }
            document.body.style.overflow = 'auto';
            
            // Clean up any overlays
            const overlays = document.querySelectorAll('.modal');
            overlays.forEach(overlay => {
                overlay.style.display = 'none';
                overlay.classList.add('hidden');
            });
            
            console.log('Emergency modal closure complete');
        };

        // ============================================
        // MICRO-INTERACTIONS & ANIMATIONS
        // ============================================
        
        // Enhanced success/error feedback system
        function showFeedback(message, type = 'success', duration = 3000, element = null) {
            // Create or update feedback element
            let feedback = element || document.getElementById('globalFeedback');
            if (!feedback) {
                feedback = document.createElement('div');
                feedback.id = 'globalFeedback';
                feedback.className = 'feedback-toast';
                document.body.appendChild(feedback);
            }
            
            // Set content and type
            feedback.textContent = message;
            feedback.className = `feedback-toast ${type}`;
            
            // Trigger animation
            feedback.style.display = 'flex';
            setTimeout(() => feedback.classList.add('show'), 10);
            
            // Auto-hide
            setTimeout(() => {
                feedback.classList.remove('show');
                setTimeout(() => {
                    feedback.style.display = 'none';
                    feedback.className = 'feedback-toast';
                }, 300);
            }, duration);
        }
        
        // Enhanced button loading state
        function setButtonLoading(button, loading = true, originalText = null) {
            if (!button) return;
            
            if (loading) {
                button.dataset.originalText = originalText || button.textContent;
                button.innerHTML = '<span class="btn-spinner"></span> Loading...';
                button.disabled = true;
                button.classList.add('loading');
            } else {
                button.innerHTML = button.dataset.originalText || 'Submit';
                button.disabled = false;
                button.classList.remove('loading');
                delete button.dataset.originalText;
            }
        }
        
        // Enhanced progress indicator
        function showProgressIndicator(container, message = 'Processing...') {
            if (!container) return;
            
            const progress = document.createElement('div');
            progress.className = 'progress-indicator active';
            progress.innerHTML = `
                <div class="progress-spinner"></div>
                <div class="progress-text">${message}</div>
            `;
            
            container.appendChild(progress);
            return progress;
        }
        
        function updateProgressIndicator(progressElement, percentage, message) {
            if (!progressElement) return;
            
            const textEl = progressElement.querySelector('.progress-text');
            if (textEl) textEl.textContent = message;
            
            // Update any progress bars
            const progressBar = progressElement.querySelector('.progress-fill');
            if (progressBar) {
                progressBar.style.width = `${percentage}%`;
            }
        }
        
        // Enhanced modal animations
        function showModalWithAnimation(modal, callback = null) {
            if (!modal) return;
            
            modal.style.display = 'flex';
            modal.classList.remove('hidden');
            
            // Trigger entrance animation
            requestAnimationFrame(() => {
                modal.classList.add('modal-enter');
                if (callback) callback();
            });
        }
        
        function hideModalWithAnimation(modal, callback = null) {
            if (!modal) return;
            
            modal.classList.add('modal-exit');
            
            setTimeout(() => {
                modal.style.display = 'none';
                modal.classList.add('hidden');
                modal.classList.remove('modal-enter', 'modal-exit');
                if (callback) callback();
            }, 300);
        }
        
        // Content loading with skeleton animation
        function showSkeletonLoader(container, count = 3) {
            if (!container) return;
            
            const skeleton = document.createElement('div');
            skeleton.className = 'skeleton-container';
            
            for (let i = 0; i < count; i++) {
                const item = document.createElement('div');
                item.className = 'skeleton-item';
                skeleton.appendChild(item);
            }
            
            container.appendChild(skeleton);
            return skeleton;
        }
        
        function removeSkeletonLoader(container) {
            if (!container) return;
            
            const skeleton = container.querySelector('.skeleton-container');
            if (skeleton) {
                skeleton.classList.add('fade-out');
                setTimeout(() => skeleton.remove(), 300);
            }
        }
        
        // Enhanced card interactions
        function initializeCardAnimations() {
            const cards = document.querySelectorAll('.content-card, .tool-card, .lesson-card');
            
            cards.forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.classList.add('hover-lift');
                });
                
                card.addEventListener('mouseleave', () => {
                    card.classList.remove('hover-lift');
                });
                
                card.addEventListener('click', (e) => {
                    // Add click ripple effect
                    const ripple = document.createElement('div');
                    ripple.className = 'click-ripple';
                    
                    const rect = card.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;
                    
                    ripple.style.width = ripple.style.height = size + 'px';
                    ripple.style.left = x + 'px';
                    ripple.style.top = y + 'px';
                    
                    card.appendChild(ripple);
                    
                    setTimeout(() => ripple.remove(), 600);
                });
            });
        }
        
        // Enhanced form interactions
        function initializeFormAnimations() {
            const inputs = document.querySelectorAll('input, textarea, select');
            
            inputs.forEach(input => {
                input.addEventListener('focus', () => {
                    input.parentElement?.classList.add('input-focused');
                });
                
                input.addEventListener('blur', () => {
                    input.parentElement?.classList.remove('input-focused');
                    if (input.value) {
                        input.parentElement?.classList.add('input-has-value');
                    } else {
                        input.parentElement?.classList.remove('input-has-value');
                    }
                });
            });
        }
        
        // File upload animations
        function animateFileUpload(fileElement, status = 'uploading') {
            if (!fileElement) return;
            
            fileElement.classList.remove('upload-success', 'upload-error', 'upload-uploading');
            fileElement.classList.add(`upload-${status}`);
            
            if (status === 'success') {
                setTimeout(() => {
                    fileElement.classList.add('upload-complete');
                }, 100);
            }
        }
        
        // Initialize all micro-interactions
        function initializeMicroInteractions() {
            console.log('Initializing micro-interactions...');
            
            // Initialize card animations
            initializeCardAnimations();
            
            // Initialize form animations
            initializeFormAnimations();
            
            // Enhanced button interactions
            const buttons = document.querySelectorAll('.btn, .tool-btn');
            buttons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    btn.classList.add('btn-pressed');
                    setTimeout(() => btn.classList.remove('btn-pressed'), 150);
                });
            });
            
            // Scroll-triggered animations
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-in');
                    }
                });
            }, observerOptions);
            
            // Observe elements for scroll animations
            const animateElements = document.querySelectorAll('.content-card, .tool-card, .section-header');
            animateElements.forEach(el => observer.observe(el));
            
            console.log('Micro-interactions initialized successfully');
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        window.addEventListener('load', async () => {
            console.log("Initializing application...");
            
            // Ensure modal is hidden on page load
            const modal = document.getElementById('bulkUploadModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
                console.log('Modal initialized as hidden');
            }
            
            if (initializeMSAL()) {
                console.log("MSAL initialized successfully");
                
                try {
                    const response = await msalInstance.handleRedirectPromise();
                    console.log("Redirect response:", response);
                    
                    if (response && response.account) {
                        await handleAuthResponse(response);
                    } else {
                        await checkExistingLogin();
                    }
                } catch (error) {
                    console.error("Error handling redirect:", error);
                }
            } else {
                console.error("Failed to initialize MSAL");
            }
            
            render();
            
            // Initialize micro-interactions after DOM is ready
            setTimeout(() => {
                initializeMicroInteractions();
            }, 100);
        });

        // Prevent context menu
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            return false;
        });
    </script>
</body>
</html>